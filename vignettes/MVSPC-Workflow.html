<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Gabriel Odom" />

<meta name="date" content="2017-04-25" />

<title>Multivariate Statistical Process Control with mvMonitoring</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Multivariate Statistical Process Control with mvMonitoring</h1>
<h4 class="author"><em>Gabriel Odom</em></h4>
<h4 class="date"><em>2017-04-25</em></h4>



<p>This document serves to introduce engineers to the workflow necessary to follow in order to analyze multivariate process monitoring data via the <code>mvMonitoring</code> package.</p>
<p><br> <br></p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This is the accompanying package to the research published by <a href="https://link.springer.com/article/10.1007/s00477-016-1246-2">Kazor et al (2016)</a> and forthcoming paper by <a href="https://www.overleaf.com/read/vbfbjsywtkvv#/26878504/">Odom et al (2017)</a> (manuscript in progress). The <code>mvMonitoring</code> package is designed to make simulation of multi-state multivariate process monitoring statistics easy and straightforward, as well as streamlining the online process monitoring component.</p>
<div id="why-use-mvmonitoring" class="section level2">
<h2>Why use <code>mvMonitoring</code></h2>
<p>The <code>mvMonitoring</code> package can be used to detect outliers in a correlated multivariate process with non-linear, non-stationary, or autocorrelated feature behavior. These process outliers are often indicative of system fault. The common and naive approach to multivariate process monitoring is to use expert opinion to identify a few important features to monitor visually, and raise an alarm if these features travel outside pre-defined normal operating boundaries.</p>
<p>However, this split univariate approach fails to account for the correlated nature of the process features, so some engineers have taken to monitoring the system as a single correlated multivariate process rather than a collection of independent univaraite processes. In the literature review of the motivating papers, the authors cite how this approach has benefitted the science of process monitoring as a whole. Unfortunately, this approach has its own shortcomings – namely, montioring a multivariate process in its original feature space can lead to exorbitant computational costs.</p>
<p>To this end, <em>principal components analysis</em> (PCA) and its many modifications have been employed to reduce the computation necessary to monitor a multivariate process as a whole. This package is an implementation of one such PCA modification.</p>
</div>
<div id="multi--or-single-state-ad-pca" class="section level2">
<h2>Multi- or Single-State AD-PCA</h2>
<p>AD-PCA is <em>adaptive-dynamic</em> PCA, which accounts for non-linearity, non-stationarity, and autocorrelation in the multivariate process, and this modification is thoroghly discussed in Kazor et al (2016).</p>
<dl>
<dt>Multi-State Monitoring</dt>
<dd>a modification of PCA which accounts for multiple process states and models them seperately. States can be any mutually exclusive blocking factor, and states do not necessarily follow a strict order.
</dd>
</dl>
<p>Multi-State AD-PCA (MSAD-PCA) allows process engineers to account for a few very different process states. Specifically, this modification should be used when features under different process states have different means, correlations, or variances.</p>
<p><br> <br></p>
</div>
</div>
<div id="the-msp-functions" class="section level1">
<h1>The <code>msp</code> Functions</h1>
<p>These are brief descriptions of the external functions useful for multivariate statistical process monitoring via MSAD- or AD-PCA.</p>
<div id="simulating-data-with-mspprocessdata" class="section level2">
<h2>Simulating Data with <code>mspProcessData</code></h2>
<p>This function generates three-dimensional multi-state or single-state non-linear, non-stationary, and autocorrelated process observations. We follow the seminal work of <a href="http://onlinelibrary.wiley.com/doi/10.1002/aic.690420810/abstract">Dong and McAvoy (1996)</a> for generation of the foundational stationary and independent features.</p>
<div id="latent-feature-creation" class="section level3">
<h3>Latent Feature Creation</h3>
<p>So that the simulated features have non-zero correlations, Dong and McAvoy created their three features all as polynomial functions of a single latent variable <span class="math inline">\(t(s)\)</span>, where <span class="math inline">\(s = 1, \ldots, \omega\)</span> is the observational index of the process.</p>
<div id="autocorrelated-and-non-stationary-error" class="section level4">
<h4>Autocorrelated and Non-Stationary Error</h4>
<p>The <code>mspProcesData</code> function induces autocorrelation in <span class="math inline">\(t\)</span> through its errors, <span class="math inline">\(\varepsilon_s\)</span>, where <span class="math display">\[
\varepsilon_1 \sim \mathcal{N}\left(\frac{1}{2}(a + b)(1 - \phi), \frac{b - a}{12} (1 - \phi ^ 2)\right),
\]</span> where <span class="math inline">\(a = 0.01\)</span> and <span class="math inline">\(b = 2\)</span>. Now, we define the first-order autoregressive process on <span class="math inline">\(\varepsilon_s\)</span> by <span class="math display">\[
\varepsilon_s = \varphi\varepsilon_{s - 1} + (1 - \varphi)\varepsilon,
\]</span> where <span class="math inline">\(\varepsilon\)</span> is as defined in the previous expression and the autocorrelation component <span class="math inline">\(\phi = 0.75\)</span>. The mean and variance multipliers are the mean and variance of a random variable from the <span class="math inline">\(\mathcal{U}_{[a,b]}\)</span> distribution.</p>
</div>
<div id="the-non-linear-latent-process" class="section level4">
<h4>The Non-Linear Latent Process</h4>
<p>This <span class="math inline">\(t\)</span> vector will be sinusoidal with period <span class="math inline">\(\omega = 7 * 24 * 60\)</span> (signifying a weekly period in minute-level observations). We then synthesize a <span class="math inline">\(t\)</span> with <span class="math display">\[
t^*_s = -\cos\left( \frac{2\pi}{\omega} s \right) + \epsilon_s,
\]</span> and scale <span class="math inline">\(t^*\)</span> to <span class="math display">\[
t = \frac{(b - a)(t^*_s - \text{min}(t^*_s))}{\text{max}(t^*_s) - \text{min}(t^*_s)} + a.
\]</span> Finally then, the <span class="math inline">\(t\)</span> vector will lie entirely in <span class="math inline">\([a,b]\)</span>.</p>
</div>
</div>
<div id="single-state-and-multi-state-features" class="section level3">
<h3>Single-State and Multi-State Features</h3>
<div id="single-state-features" class="section level4">
<h4>Single State Features</h4>
First <code>mspProcessData</code> simulates three features, with each feaure operating under <span class="math inline">\(k\)</span> different states. Let <span class="math inline">\(&lt;x_k(t), y_k(t), z_k(t)&gt;\)</span> be the notation for State <span class="math inline">\(k\)</span>. These are the three features under State 1 (normal operating conditions, or <em>NOC</em>) as three functions of <span class="math inline">\(t\)</span>:
<span class="math display">\[\begin{align}
  \textbf{x}(\textbf{t}) &amp;\equiv \textbf{t} + \boldsymbol\varepsilon_1, \\
  \textbf{y}(\textbf{t}) &amp;\equiv \textbf{t} ^ 2 - 3 * \textbf{t} + \boldsymbol\varepsilon_2, \\
  \textbf{z}(\textbf{t}) &amp;\equiv -\textbf{t} ^ 3 + 3 * \textbf{t} ^ 2 + \boldsymbol\varepsilon_3,
\end{align}\]</span>
<p>where <span class="math inline">\(\varepsilon_i \sim N(0, 0.01)\)</span>. The <code>mspProcessData</code> function calls the internal <code>processNOCdata</code> function to generate single-state observations under normal operating conditions (NOC).</p>
</div>
<div id="multi-state-features" class="section level4">
<h4>Multi-State Features</h4>
<p>The multi-state feature expression is induced by rotation and scaling of certain sets of observations. To induce a three-state, hourly switching process (the default), the <code>mspProcessData</code> function will create a label column that switches from “1” to “2” to “3” every hour. State “1” will be the features generated under the single-state assumption, while State “2” and State “3” are generated as follows. These states will be scaled rotations of the current <span class="math inline">\(&lt;x,y,z&gt;\)</span> set. The second state is yaw, pitch, and roll rotated by (0, 90, 30) degrees, and the scales are multiplied by (1, 0.5, 2). The third state is yaw, pitch, and roll rotated by (90, 0, -30) degrees, and the scales are multiplied by (0.25, 0.1, 0.75).</p>
<ul>
<li><p><span class="math inline">\(\mathcal{S}_1\)</span>: <span class="math inline">\(\textbf{X}(t_s) := \langle x(t_s), y(t_s), z(t_s)\rangle\)</span>.</p></li>
<li><p><span class="math inline">\(\mathcal{S}_2\)</span>: <span class="math inline">\(\textbf{X}(t_s) := \langle x(t_s), y(t_s), z(t_s)\rangle \cdot \textbf{P}_1\boldsymbol\Lambda_1\)</span>, where <span class="math display">\[
\textbf{P}_1 = \begin{bmatrix}
 0    &amp;  0.50 &amp; -0.87 \\
 0    &amp;  0.87 &amp;  0.50 \\
 1    &amp;  0    &amp;  0   
\end{bmatrix}
\]</span> is the orthogonal rotation matrix for a yaw, pitch and roll degree change of <span class="math inline">\(\langle 0^{\circ}, 90^{\circ}, 30^{\circ} \rangle\)</span>, and <span class="math inline">\(\boldsymbol\Lambda_1 = \text{diag}(1, 0.5, 2)\)</span> is a diagonal scaling matrix.</p></li>
<li><p><span class="math inline">\(\mathcal{S}_3\)</span>: <span class="math inline">\(\textbf{X}(t_s) := \langle x(t_s), y(t_s), z(t_s)\rangle \cdot \textbf{P}_2\boldsymbol\Lambda_2\)</span>, where <span class="math display">\[
\textbf{P}_2 = \begin{bmatrix}
 0    &amp;  0.87 &amp; -0.50 \\
-1    &amp;  0    &amp;  0    \\
 0    &amp;  0.50 &amp;  0.87
\end{bmatrix}
\]</span> is the orthogonal rotation matrix for a yaw, pitch and roll degree change of <span class="math inline">\(\langle 90^{\circ}, 0^{\circ}, -30^{\circ} \rangle\)</span>, and <span class="math inline">\(\boldsymbol\Lambda_2 = \text{diag}(0.25, 0.1, 0.75)\)</span> is a diagonal scaling matrix.</p></li>
</ul>
<p>These rotation matrices <span class="math inline">\(\textbf{P}_1\)</span> and <span class="math inline">\(\textbf{P}_2\)</span> turn the states in three-dimensional space so that the states are at right angles to each other in at least one dimension, and the scaling matrices <span class="math inline">\(\boldsymbol\Lambda_1\)</span> and <span class="math inline">\(\boldsymbol\Lambda_2\)</span> inflate or deflate the process variances along each principal component. The <code>mspProcessData</code> function calls the internal function <code>dataStateSwitch</code> which splits the observations by state and applies the state-specific rotation and scaling through the internal <code>rotateScale3D</code> function.</p>
</div>
</div>
<div id="synthetic-fault-induction" class="section level3">
<h3>Synthetic Fault Induction</h3>
<p>Faults can be introduced to single- or multi-state data via the <code>mspProcessData</code> function. The default fault strt index is 8500, or roughly 84% through the 10,080 observation cycle. These faults are added through the internal <code>faultSwitch</code> function.</p>
<ul>
<li><p>Fault 1A is a positive shift to all three features before state rotation: <span class="math inline">\(\textbf{X}^*(t_s) = \textbf{X}(t_s) + 2,\ s \ge 8500\)</span>.</p></li>
<li><p>Fault 1B is a positive shift to the <span class="math inline">\(x\)</span> feature before state rotation: <span class="math inline">\(x^*(t_s) = x(t_s) + 2,\ s \ge 8500\)</span>.</p></li>
<li><p>Fault 1C is a positive shift to the <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> features in State 3 only and <em>after</em> state rotation: <span class="math inline">\(x^*(t_s) = x(t_s) + 2,\ z^*(t_s) = z(t_s) + 2,\ s \ge 8500\)</span>.</p></li>
<li><p>Fault 2A is a positive drift across all the process monitoring features before state rotation: <span class="math inline">\(\textbf{X}^*(t_s) = \textbf{X}(t_s) + (s - 8500)\times 10^{-3}\)</span>, <span class="math inline">\(s &gt; 8500\)</span>.</p></li>
<li><p>Fault 2B is a positive drift across the <span class="math inline">\(y\)</span> and <span class="math inline">\(z\)</span> process monitoring features before state rotation: <span class="math inline">\(y^*(t_s) = y(t_s) + (s - 8500)\times 10^{-3},\ z^*(t_s) = z(t_s) + (s - 8500)\times 10^{-3}\)</span>, <span class="math inline">\(s &gt; 8500\)</span>.</p></li>
<li><p>Fault 2C is a negative drift in the <span class="math inline">\(y\)</span> process monitoring feature in State 2 only and <em>after</em> state rotation: <span class="math inline">\(y^*(t_s) = y(t_s) - 1.5 \times \frac{s - 8500}{10080 - 8500}\)</span>, for <span class="math inline">\(s &gt; 8500\)</span>.</p></li>
<li><p>Fault 3A is an amplification of the underlying latent variable <span class="math inline">\(t\)</span> for all features. The maximum latent drift of this fault will be 5 + 1: <span class="math inline">\(\textbf{X}^*(t_s) = \textbf{X}(t_s^*),\ s &gt; 8500\)</span>, where <span class="math inline">\(t_s^* = \left[\frac{5(s - 8500)}{\omega - 8500} + 1\right]t_s\)</span>.</p></li>
<li><p>Fault 3B is a mutation of the underlying latent variable <span class="math inline">\(t\)</span> for the <span class="math inline">\(z\)</span> feature: <span class="math inline">\(z^*(t_s) = z(\log t_s^*)\)</span>, <span class="math inline">\(s \ge 8500\)</span>. This fault will dampen the underlying latent effect for <span class="math inline">\(z\)</span> if <span class="math inline">\(t_s &gt; 1\)</span> and amplify this effect if <span class="math inline">\(t_s &lt; 1\)</span>.</p></li>
<li><p>Fault 3C is a polynomial mutation of the error for the <span class="math inline">\(y\)</span> feature in State 2 only and <em>after</em> state rotation: <span class="math inline">\(y^*(t_s) = y(t_s) + 2 * \textbf{e}_3(s) - 0.25\)</span>, for <span class="math inline">\(s &gt; 8500\)</span>.</p></li>
</ul>
</div>
<div id="putting-it-all-together" class="section level3">
<h3>Putting it all together…</h3>
<p>The <code>mspProcessData</code> function can generate weeks’ worth of non-linear, non-stationary, autocorrelated, multi-state, multivariate process data useful to test new process monitoring techniques. Users can generate observations under NOC to measure false alarm rates, or induce one of nine pre-built faults to test detection time and consistency with repeated Monte Carlo sampling. We expect this function will generate interesting data useful enough to compare new and improved process monitoring techniques with existing methods.</p>
</div>
</div>
<div id="training-with-msptrain" class="section level2">
<h2>Training with <code>mspTrain</code></h2>
<p>The <code>mspTrain</code> function will generate projection matrices and test statistic thresholds from test data matrices.</p>
<div id="the-xts-data-matrix" class="section level3">
<h3>The <code>xts</code> Data Matrix</h3>
<p>An <code>xts</code> data matrix is first and foremost a matrix, <em>not</em> a data frame. For users very familiar with data frame manipulation (with <code>dplyr</code> for instance), the slight but profound differences between manipulating matrices and data frames become quickly apparent. Because of the class requirements for matrices, <em>all</em> features must be integer or double objects. The <code>mspTrain</code> function cannot train on character information.</p>
<p>The <code>xts</code> object class stands for <em>extendible time series</em> and comes from the package <code>xts</code>, which is itself built on the package <code>zoo</code>. The date and time information (necessarily as <code>POSIX</code> objects) are stored as the row indices of <code>xts</code> matrices. We recommend the package <code>lubridate</code> for manipulating <code>POSIX</code> objects.</p>
</div>
<div id="the-class-vector" class="section level3">
<h3>The Class Vector</h3>
<p>When implementing single-state AD-PCA, this class vector simply needs to be a numeric column of the same value. However, for MSAD-PCA, the class vector should be an integer vector of class membership. The <code>mspTrain</code> function will split the observations by the class label, apply single-state AD-PCA to each class, then return the class-specific projection matrices and thresholds. Because of this split-apply-combine strategy, users must ensure that one or more classes are not too “rare” – that is, the class-specific sample size should be sufficiently large to allow for stable covariance matrix inversion. For <span class="math inline">\(p\)</span> features (inlcuding lags), covariance inversion requires a class sample size greater than <span class="math inline">\(p ^ 2 / 2\)</span>. Because of this, pay close attention to model parsimony – don’t block the observations on a factor unless the factor significantly affects the observations’ mean vector or covariance matrix.</p>
</div>
<div id="adaptive-and-dynamic-modelling" class="section level3">
<h3>Adaptive and Dynamic Modelling</h3>
<p>Because of the non-linear, non-stationary, and autocorrelated nature of some process monitoring applications, the <code>mspTrain</code> function allows users to include lags of all feature variables and also to update the training window over time. Including lags of the features in the data matrix can significantly reduce the negative effects of autocorrelation. Re-estimating the projection matrix and test statistic thresholds at pre-specified time intervals reduces the negative effects of non-linearity and non-stationarity in the observations.</p>
<p>The idea is to divide a non-linear and non-stationary process along some boundaries (every day, for instance), and then the process becomes locally linear and stationary within the window. As time progresses, the oldest observations are “forgotten” and the newest observations are “learned”, which causes the projection and NOC thresholds to update over time.</p>
</div>
<div id="model-training" class="section level3">
<h3>Model Training</h3>
<p>After the observations have been split by class, the <code>mspTrain</code> function will call the internal function <code>processMonitor</code>, which in turn calls the internal function <code>faultFilter</code>. This function will calculate a linear projection matrix of the data by taking the PCA of the training data matrix. The observations will then be projected linearly into a reduced-feature subspace which preserves a chosen proportion of the energy of the training data, where the energy of a matrix is the sum of eigenvalues of that matrix. The default proportion is 90%. This projection is calculated by the internal <code>pca</code> function.</p>
<p>Furthermore, non-parametric threshold values are calculated for the two process monitoring statistics – <em>Squared Prediction Error</em> and <em>Hotelling’s <span class="math inline">\(T^2\)</span></em>. These monitoring statistics are described in the motivating paper. These threshold values are found in the internal <code>threshold</code> function, and passed through the function pipe to be returned by <code>mspTrain</code>. The <span class="math inline">\(\alpha\)</span>-level of the nonparametric threshold is controlled by the user, and its default value is 0.001.</p>
<p>Finally, the <code>mspTrain</code> function will remove any observation which would cause an alarm from the training data set. The alarm free observations will be returned in one <code>xts</code> matrix, while the alarmed observations will be returned by another. When training your process monitor, pay attention to the observations flagged as alarms. The proportion of observations flagged as faults may be higher than the <span class="math inline">\(\alpha\)</span>-level specified, so some tuning may be necessary.</p>
</div>
</div>
<div id="monitoring-incoming-observations-with-mspmonitor" class="section level2">
<h2>Monitoring Incoming Observations with <code>mspMonitor</code></h2>
<p>After training the model with <code>mspTrain</code>, the projection matrices and non-parametric monitoring statistic thresholds can be used to flag incoming observations. This function can check every observation in a test matrix (useful when analyzing past data), but was instead designed to test a single incoming observation at a time via a script or batch file. To this end, the <code>mspMonitor</code> function projects a single observation with the class projection matrices returned by <code>mspTrain</code> and checks the observation’s SPE and <span class="math inline">\(T^2\)</span> statistics against the thresholds returned by <code>mspTrain</code>. The <code>mspMonitor</code> will then append the monitoring statistic values, and indicators if these values exceed normal thresholds, to the end of the observation row. This new appended observation will be passed to the <code>mspWarning</code> function.</p>
</div>
<div id="issue-a-warning-with-mspwarning" class="section level2">
<h2>Issue a Warning with <code>mspWarning</code></h2>
<p>If an observation returned by the <code>mspMonitor</code> function has positive statistic indicator values for either the SPE or <span class="math inline">\(T^2\)</span> monitoring statistics, then the <code>mspWarning</code> function will query the last set <span class="math inline">\(r\)</span> observations for other flags. If all <span class="math inline">\(r\)</span> observations are positive for anomalies, then the <code>mspWarning</code> function will issue an alarm. This is the parameter “faultsToTriggerAlarm”, and it defaults to 5. However, this default value depends heavily on the scale of the data: for continuous observations aggregated and recorded every five seconds, the number of sequential faults necessary to trigger an alarm should be very high, perhaps even 50 or more. For observations aggregated to the 10-minute-scale, only three sequential faults may be necessary.</p>
<p>In future updates of this package, this function will also have an option to issue an alarm if a critical mass of non-sequential alarms is reached in a set period of observations. This modification may be necessary if the observation level becomes more fine than the 1-minute-level. Additionally, this function will also be equipped to take in a cell phone number and service provider and issue an alarm via SMS through email.</p>
<p><br> <br></p>
</div>
</div>
<div id="example-simulation-workflow" class="section level1">
<h1>Example Simulation Workflow</h1>
<p>This section provides a fully-commented code walkthrough for the main <code>msp</code> functions in the <code>mvMonitoring</code> package.</p>
<div id="generating-synthetic-data" class="section level2">
<h2>Generating Synthetic Data</h2>
<p>First begin by generating multi-state data from a fault scenario. This code will yield observations under Fault 2A, as described the Synthetic Fault Induction section. We choose the default options for the period length (7 days * 24 hours * 60 minutes = 10,080 observations), the starting index of the fault (8500 out of 10080), and the time stamp for beggining the data is 16 May of 2016 at 10:00AM (my wedding anniversary). As we can see from the <code>str()</code> function, we have an <code>xts</code> matrix with 10080 rows and four columns (the state indicator and the three features).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(mvMonitoring)
fault2A_xts &lt;-<span class="st"> </span><span class="kw">mspProcessData</span>(<span class="dt">faults =</span> <span class="st">&quot;A2&quot;</span>,
                              <span class="dt">period =</span> <span class="dv">7</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                              <span class="dt">faultStartIndex =</span> <span class="dv">8500</span>,
                              <span class="dt">startTime =</span> <span class="st">&quot;2015-05-16 10:00:00 CST&quot;</span>)

<span class="kw">str</span>(fault2A_xts)</code></pre></div>
<pre><code>## An 'xts' object on 2015-05-16 10:00:00/2015-05-23 09:59:00 containing:
##   Data: num [1:10080, 1:4] 1 1 1 1 1 1 1 1 1 1 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:4] &quot;state&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;
##   Indexed by objects of class: [POSIXct,POSIXt] TZ: 
##   xts Attributes:  
##  NULL</code></pre>
</div>
<div id="train-the-fault-detection-threshold" class="section level2">
<h2>Train the Fault Detection Threshold</h2>
<p>Now that these observations are generated and stored in memory, the <code>mspTrain</code> function can train the MSAD-PCA model. We will save the last 60 observations (one hour’s worth) for testing. The <code>mspTrain</code> function takes in the training data set partitioned between the observation and the label column. If this function errors, make sure the label column is not included in the data matrix – this will cause a singularity in the data. The function will 1. Train on the first three days’ worth of observations, as set by <code>trainObs</code>. 1. Scan the fourth day for anomalies, as set by <code>updateFreq</code>. 1. Remove any alarmed observations. 1. “Forget” the first day’s observations. 1. “Learn” the non-alarmed observations from the fourth day. 1. Retrain and repeat until the end of the data matrix</p>
<p>Furthermore, the <code>Dynamic = TRUE</code> option means that the <code>mspTrain</code> function will include the lags specified by the <code>lagsIncluded</code> argument. Finally, the number of sequential anomalous observations necessary to raise an alarm is set at 5 by the <code>faultsToTriggerAlarm</code> argument. These last three arguments are set to their defaults.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train2A_xts &lt;-<span class="st"> </span>fault2A_xts[<span class="dv">1</span>:<span class="dv">10020</span>,]
<span class="co"># This function will run in 13 seconds on the author's machine.</span>
train2A_ls &lt;-<span class="st"> </span><span class="kw">mspTrain</span>(<span class="dt">data =</span> train2A_xts[,-<span class="dv">1</span>],
                       <span class="dt">labelVector =</span> train2A_xts[,<span class="dv">1</span>],
                       <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                       <span class="dt">updateFreq =</span> <span class="dv">1</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                       <span class="dt">Dynamic =</span> <span class="ot">TRUE</span>,
                       <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">1</span>,
                       <span class="dt">faultsToTriggerAlarm =</span> <span class="dv">5</span>)</code></pre></div>
</div>
<div id="test-new-observations-for-anomalies" class="section level2">
<h2>Test New Observations for Anomalies</h2>
</div>
<div id="warn-operators-during-alarms" class="section level2">
<h2>Warn Operators during Alarms</h2>
<p><br> <br></p>
</div>
</div>
<div id="example-process-monitoring-workflow" class="section level1">
<h1>Example Process Monitoring Workflow</h1>
<p>Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The <code>html_vignette</code> output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The <code>html_vignette</code> format:</p>
<ul>
<li>Never uses retina figures</li>
<li>Has a smaller default figure size</li>
<li>Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style</li>
</ul>
<div id="vignette-info" class="section level2">
<h2>Vignette Info</h2>
<p>Note the various macros within the <code>vignette</code> section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the <code>title</code> field and the <code>\VignetteIndexEntry</code> to match the title of your vignette.</p>
</div>
<div id="styles" class="section level2">
<h2>Styles</h2>
<p>The <code>html_vignette</code> template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:</p>
<pre><code>output: 
  rmarkdown::html_vignette:
    css: mystyles.css</code></pre>
</div>
<div id="figures" class="section level2">
<h2>Figures</h2>
<p>The figure sizes have been customised so that you can easily put two images side-by-side.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>:<span class="dv">10</span>)
<span class="kw">plot</span>(<span class="dv">10</span>:<span class="dv">1</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><img src="data:image/png;base64,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" /></p>
<p>You can enable figure captions by <code>fig_caption: yes</code> in YAML:</p>
<pre><code>output:
  rmarkdown::html_vignette:
    fig_caption: yes</code></pre>
<p>Then you can use the chunk option <code>fig.cap = &quot;Your figure caption.&quot;</code> in <strong>knitr</strong>.</p>
</div>
<div id="more-examples" class="section level2">
<h2>More Examples</h2>
<p>You can write math expressions, e.g. <span class="math inline">\(Y = X\beta + \epsilon\)</span>, footnotes<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, and tables, e.g. using <code>knitr::kable()</code>.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
<th align="right">am</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108.0</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td>Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258.0</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Hornet Sportabout</td>
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">175</td>
<td align="right">3.15</td>
<td align="right">3.440</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>Valiant</td>
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225.0</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.460</td>
<td align="right">20.22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Duster 360</td>
<td align="right">14.3</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">245</td>
<td align="right">3.21</td>
<td align="right">3.570</td>
<td align="right">15.84</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>Merc 240D</td>
<td align="right">24.4</td>
<td align="right">4</td>
<td align="right">146.7</td>
<td align="right">62</td>
<td align="right">3.69</td>
<td align="right">3.190</td>
<td align="right">20.00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td>Merc 230</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">140.8</td>
<td align="right">95</td>
<td align="right">3.92</td>
<td align="right">3.150</td>
<td align="right">22.90</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>Merc 280</td>
<td align="right">19.2</td>
<td align="right">6</td>
<td align="right">167.6</td>
<td align="right">123</td>
<td align="right">3.92</td>
<td align="right">3.440</td>
<td align="right">18.30</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>Also a quote using <code>&gt;</code>:</p>
<blockquote>
<p>“He who gives up [code] safety for [code] speed deserves neither.” (<a href="https://twitter.com/hadleywickham/status/504368538874703872">via</a>)</p>
</blockquote>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A footnote here.<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
