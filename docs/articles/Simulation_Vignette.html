<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSAD-PCA Walkthrough • mvMonitoring</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mvMonitoring</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MVSPC-Workflow.html">Multivariate Statistical Process Control with mvMonitoring</a>
    </li>
    <li>
      <a href="../articles/Simulation_Vignette.html">MSAD-PCA Walkthrough</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>MSAD-PCA Walkthrough</h1>
                        <h4 class="author">Gabriel Odom</h4>
            
            <h4 class="date">2017-07-07</h4>
          </div>

    
    
<div class="contents">
<div id="multi-state-adaptive-dynamic-pca-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-state-adaptive-dynamic-pca-simulation" class="anchor"></a>Multi-State Adaptive-Dynamic PCA Simulation</h2>
<p>We create this package, <code>mvMonitoring</code>, from the foundation laid by Kazor et al (2016). The <code>mvMonitoring</code> package is designed to make simulation of multi-state multivariate process monitoring statistics easy and straightforward, as well as streamlining the online process monitoring component.</p>
<div id="the-interval-vector" class="section level3">
<h3 class="hasAnchor">
<a href="#the-interval-vector" class="anchor"></a>The Interval Vector</h3>
<p>We begin by simulating an autocorrelated interval-step vector <span class="math inline">\(t\)</span>. This vector <span class="math inline">\(t\)</span> has induced autocorrelation in its errors, <span class="math inline">\(\varepsilon\)</span>, where these autocorrelated errors have initial values and independent components given by <span class="math display">\[ \varepsilon \sim \mathcal{N}\left(\frac{1}{2}(a + b)(1 - \phi), \frac{b - a}{12} (1 - \phi ^ 2)\right), \]</span> where <span class="math inline">\(\epsilon_1\)</span> is a random draw from this distribution, <span class="math inline">\(a = 0.01\)</span>, <span class="math inline">\(b = 2\)</span>, and the autocorrelation component <span class="math inline">\(\phi = 0.75\)</span>. The mean and variance multipliers are the mean and variance of a random variable from the <span class="math inline">\(\mathcal{U}_{[a,b]}\)</span> distribution. The full autocorrelated error structure is then <span class="math display">\[ \epsilon_s = \phi\epsilon_{s - 1} + (1 - \phi)\varepsilon.
\]</span> This <span class="math inline">\(t\)</span> vector will be sinusoidal with period <span class="math inline">\(\omega = 7 * 24 * 60\)</span> (signifying a weekly period in minute-level observations). We then synthesize a <span class="math inline">\(t\)</span> with <span class="math inline">\(t^*_1 = -\cos\left(\frac{2\pi}{\omega}\right) + \epsilon_1\)</span>, and <span class="math display">\[ t^*_s = -\cos\left(\frac{2\pi}{\omega}\right) + \epsilon_s.
\]</span> The final <span class="math inline">\(t\)</span> vector is the <span class="math inline">\(t^*\)</span> vector scaled to lie entirely in <span class="math inline">\([a,b]\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">omega &lt;-<span class="st"> </span><span class="dv">60</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">7</span>
phi &lt;-<span class="st"> </span><span class="fl">0.75</span>
a &lt;-<span class="st"> </span><span class="fl">0.01</span>; b &lt;-<span class="st"> </span><span class="dv">2</span>
mean_t_err &lt;-<span class="st"> </span><span class="fl">0.5</span> *<span class="st"> </span>(a +<span class="st"> </span>b) <span class="co"># mean of Uniform(0.01,2)</span>
var_t_err &lt;-<span class="st"> </span>(b -<span class="st"> </span>a) /<span class="st"> </span><span class="dv">12</span> <span class="co"># variance of Uniform(0.01,2)</span>

<span class="co"># Create an autocorrelated vector of errors for the random variable t</span>
t_err &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> omega)
<span class="co"># Initialise the errors so that the overall mean and variance match the sim of</span>
<span class="co"># Kazor et al.</span>
t_err[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>,
                  <span class="dt">mean =</span> mean_t_err *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>phi),
                  <span class="dt">sd =</span> <span class="kw">sqrt</span>(var_t_err *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>phi ^<span class="st"> </span><span class="dv">2</span>)))
for(s in <span class="dv">2</span>:omega){
  t_err[s] &lt;-<span class="st"> </span>phi *<span class="st"> </span>t_err[(s -<span class="st"> </span><span class="dv">1</span>)] +
<span class="st">    </span>(<span class="dv">1</span> -<span class="st"> </span>phi) *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>,
                      <span class="dt">mean =</span> mean_t_err *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>phi),
                      <span class="dt">sd =</span> <span class="kw">sqrt</span>(var_t_err *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>phi ^<span class="st"> </span><span class="dv">2</span>)))
}

<span class="co"># Now for the vector itself</span>
s &lt;-<span class="st"> </span><span class="dv">1</span>:omega
t_star &lt;-<span class="st"> </span>-<span class="kw">cos</span>(<span class="dv">2</span> *<span class="st"> </span>pi *<span class="st"> </span>s /<span class="st"> </span>omega) +<span class="st"> </span>t_err

<span class="co"># Now we scale the ts to match the ts from the Unif(0.01,2)</span>
t_star_adj &lt;-<span class="st"> </span>((b -<span class="st"> </span>a) *<span class="st"> </span>(t_star -<span class="st"> </span><span class="kw">min</span>(t_star))) /
<span class="st">  </span>(<span class="kw">max</span>(t_star) -<span class="st"> </span><span class="kw">min</span>(t_star)) +<span class="st"> </span>a</code></pre></div>
<p>Now that we have created the underlying autocorrelated and non-stationary process vector <span class="math inline">\(t\)</span>, we perform some simple confirmatory graphing techniques.</p>
<p><img src="Simulation_Vignette_files/figure-html/t_vec_graphs-1.png" width="672"><img src="Simulation_Vignette_files/figure-html/t_vec_graphs-2.png" width="672"> As we can see, <span class="math inline">\(t\)</span> is autocorrelated and non-stationary with mean 0.2520904 and variance 0.5104405.</p>
</div>
<div id="features-and-state-features" class="section level3">
<h3 class="hasAnchor">
<a href="#features-and-state-features" class="anchor"></a>Features and State Features</h3>
<p>We will simulate three features, with each feaure operating under <span class="math inline">\(k\)</span> different states. We will use <span class="math inline">\(&lt;x(t), y(t), z(t)&gt;\)</span> instead of the <span class="math inline">\(&lt;x_1(t), x_2(t), x_3(t)&gt;\)</span> notation used in Kazor et al. This will assist us when we introduce feature states. Our state notation will be <span class="math inline">\(&lt;x_k(t), y_k(t), z_k(t)&gt;\)</span> for State <span class="math inline">\(k\)</span>.</p>
We create the three features under State 1 (normal operating conditions, or ) as three functions of <span class="math inline">\(t\)</span>:
<span class="math display">\[\begin{align}
\textbf{x}(\textbf{t}) &amp;\equiv \textbf{t} + \boldsymbol\varepsilon_1, \\
\textbf{y}(\textbf{t}) &amp;\equiv \textbf{t} ^ 2 - 3 * \textbf{t} + \boldsymbol\varepsilon_2, \\
\textbf{z}(\textbf{t}) &amp;\equiv -\textbf{t} ^ 3 + 3 * \textbf{t} ^ 2 + \boldsymbol\varepsilon_3, \end{align}\]</span>
<p>where <span class="math inline">\(\varepsilon_i \sim N(0, 0.01)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(scatterplot3d)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## Warning: package 'tidyverse' was built under R version 3.4.1</code></pre>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mvMonitoring)

normal_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">t =</span> t_star_adj,
                        <span class="dt">err1 =</span> <span class="kw">rnorm</span>(<span class="dt">n =</span> omega, <span class="dt">sd =</span> <span class="kw">sqrt</span>(<span class="fl">0.01</span>)),
                        <span class="dt">err2 =</span> <span class="kw">rnorm</span>(<span class="dt">n =</span> omega, <span class="dt">sd =</span> <span class="kw">sqrt</span>(<span class="fl">0.01</span>)),
                        <span class="dt">err3 =</span> <span class="kw">rnorm</span>(<span class="dt">n =</span> omega, <span class="dt">sd =</span> <span class="kw">sqrt</span>(<span class="fl">0.01</span>)))

###  State 1  ###
normal_df %&lt;&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">x =</span> t +<span class="st"> </span>err1,
                     <span class="dt">y =</span> t ^<span class="st"> </span><span class="dv">2</span> -<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t +<span class="st"> </span>err2,
                     <span class="dt">z =</span> -t ^<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span>err3)

orig_state_mat &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">                    </span><span class="kw">select</span>(x,y,z) %&gt;%
<span class="st">                    </span>as.matrix</code></pre></div>
<p>Let’s take a look at our 3D scatterplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scatterplot3d</span>(<span class="dt">x =</span> normal_df$x,
              <span class="dt">y =</span> normal_df$y,
              <span class="dt">z =</span> normal_df$x,
              <span class="dt">angle =</span> <span class="dv">15</span>,
              <span class="dt">highlight.3d =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state1_scatter-1.png" width="672"></p>
<p>Now we can create data for our other two states. These states will be scaled rotations of the current <span class="math inline">\(&lt;x,y,z&gt;\)</span> set. Thus, we need the <code><a href="http://www.rdocumentation.org/packages/mvMonitoring/topics/rotateScale3D">mvMonitoring::rotateScale3D()</a></code> function from the <code>Rotation_Playground.R</code> file. The first state is yaw, pitch, and roll rotated by (0, 90, 30) degrees, and the scales are multiplied by (1, 0.5, 2).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  State 2  ###
state2_angles &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">yaw =</span> <span class="dv">0</span>,
                      <span class="dt">pitch =</span> <span class="dv">90</span>,
                      <span class="dt">roll =</span> <span class="dv">30</span>)
state2_scales &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="dv">2</span>)
state2_mat &lt;-<span class="st"> </span>orig_state_mat %*%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                <span class="dt">scale_factors =</span> state2_scales)</code></pre></div>
<p>We can see the effects of the rotation and scaling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scatterplot3d</span>(state2_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_2_scatter-1.png" width="672"> The second state is yaw, pitch, and roll rotated by (90, 0, -30) degrees, and the scales are multiplied by (0.25, 0.1, 0.75).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  State 3  ###
state3_angles &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">yaw =</span> <span class="dv">90</span>,
                      <span class="dt">pitch =</span> <span class="dv">0</span>,
                      <span class="dt">roll =</span> -<span class="dv">30</span>)
state3_scales &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.25</span>,<span class="fl">0.1</span>,<span class="fl">0.75</span>)
state3_mat &lt;-<span class="st"> </span>orig_state_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                               <span class="dt">scale_factors =</span> state3_scales)</code></pre></div>
<p>We can see the difference that State 3 creates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scatterplot3d</span>(state3_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_3_scatter-1.png" width="672"></p>
<p>Now, let’s combine all these state observations into one data frame, which we will then subset based on the state indicator.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Combination and Cleaning  ###
<span class="co"># Now concatenate these vectors</span>
normal_df$xState2 &lt;-<span class="st"> </span>state2_mat[,<span class="dv">1</span>]
normal_df$yState2 &lt;-<span class="st"> </span>state2_mat[,<span class="dv">2</span>]
normal_df$zState2 &lt;-<span class="st"> </span>state2_mat[,<span class="dv">3</span>]
normal_df$xState3 &lt;-<span class="st"> </span>state3_mat[,<span class="dv">1</span>]
normal_df$yState3 &lt;-<span class="st"> </span>state3_mat[,<span class="dv">2</span>]
normal_df$zState3 &lt;-<span class="st"> </span>state3_mat[,<span class="dv">3</span>]

<span class="co"># Add a State label column</span>
normal_df %&lt;&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">each =</span> <span class="dv">60</span>), (<span class="dv">24</span> /<span class="st"> </span><span class="dv">3</span>) *<span class="st"> </span><span class="dv">7</span>))

<span class="co"># Add a date-time column</span>
normal_df %&lt;&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dateTime =</span> <span class="kw">seq.POSIXt</span>(<span class="dt">from =</span> <span class="kw">as.POSIXct</span>(<span class="st">"2016-11-27 00:00:00 CST"</span>),
                               <span class="dt">by =</span> <span class="st">"min"</span>, <span class="dt">length.out =</span> <span class="dv">10080</span>))

###  Hourly Switching Process  ###
state1_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
state2_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
state3_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
normal_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(state1_df, state2_df, state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>Let’s take a look at the individual states, and their combined product.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_switch_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">3</span>),
                <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">3</span>, <span class="dv">1</span>),
                <span class="dt">zlim =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_scatterplots-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_switch_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">3</span>),
                <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">3</span>, <span class="dv">1</span>),
                <span class="dt">zlim =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_scatterplots-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_switch_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">3</span>),
                <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">3</span>, <span class="dv">1</span>),
                <span class="dt">zlim =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_scatterplots-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">3</span>),
                <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">3</span>, <span class="dv">1</span>),
                <span class="dt">zlim =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/state_scatterplots-4.png" width="672"></p>
</div>
<div id="fault-introduction" class="section level3">
<h3 class="hasAnchor">
<a href="#fault-introduction" class="anchor"></a>Fault Introduction</h3>
<p>We now create the faults for individual states and all states. We will introduce these faults 1000 time units after the end of training (to evauluate false positive rates). The first fault is to add 2 to each <span class="math inline">\(&lt;\textbf{x}(\textbf{t}), \textbf{y}(\textbf{t}), \textbf{z}(\textbf{t})&gt;\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faultStart &lt;-<span class="st"> </span><span class="dv">8500</span>

###  Fault 1A  ###
<span class="co"># Shift each &lt;x, y, z&gt; by 2</span>
shift &lt;-<span class="st"> </span><span class="dv">2</span>
fault1A_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, x, y, z) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> x +<span class="st"> </span>shift,
         <span class="dt">y =</span> y +<span class="st"> </span>shift,
         <span class="dt">z =</span> z +<span class="st"> </span>shift)
fault1A_mat &lt;-<span class="st"> </span>fault1A_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault1A_S2_mat &lt;-<span class="st"> </span>fault1A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="kw">scatterplot3d</span>(fault1A_S2_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1A_intro-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># State 3</span>
fault1A_S3_mat &lt;-<span class="st"> </span>fault1A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="kw">scatterplot3d</span>(fault1A_S3_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1A_intro-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now concatenate these vectors</span>
fault1A_df$xState2 &lt;-<span class="st"> </span>fault1A_S2_mat[,<span class="dv">1</span>]
fault1A_df$yState2 &lt;-<span class="st"> </span>fault1A_S2_mat[,<span class="dv">2</span>]
fault1A_df$zState2 &lt;-<span class="st"> </span>fault1A_S2_mat[,<span class="dv">3</span>]
fault1A_df$xState3 &lt;-<span class="st"> </span>fault1A_S3_mat[,<span class="dv">1</span>]
fault1A_df$yState3 &lt;-<span class="st"> </span>fault1A_S3_mat[,<span class="dv">2</span>]
fault1A_df$zState3 &lt;-<span class="st"> </span>fault1A_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault1A_state1_df &lt;-<span class="st"> </span>fault1A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault1A_state2_df &lt;-<span class="st"> </span>fault1A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault1A_state3_df &lt;-<span class="st"> </span>fault1A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault1A_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault1A_state1_df,
                               fault1A_state2_df,
                               fault1A_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>Now, let’s take a look at our process after introducing fault 1A.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault1A_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1A_scatter-1.png" width="672"> The second fault (Fault 1B) is to add 2 to feature <span class="math inline">\(&lt;\textbf{x}(\textbf{t})&gt;\)</span> only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Fault 1B  ###
<span class="co"># Shift each x by 2</span>
fault1B_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, x, y, z) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> x +<span class="st"> </span>shift)
fault1B_mat &lt;-<span class="st"> </span>fault1B_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault1B_S2_mat &lt;-<span class="st"> </span>fault1B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="kw">scatterplot3d</span>(fault1B_S2_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1B_intro-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># State 3</span>
fault1B_S3_mat &lt;-<span class="st"> </span>fault1B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="kw">scatterplot3d</span>(fault1B_S3_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1B_intro-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now concatenate these vectors</span>
fault1B_df$xState2 &lt;-<span class="st"> </span>fault1B_S2_mat[,<span class="dv">1</span>]
fault1B_df$yState2 &lt;-<span class="st"> </span>fault1B_S2_mat[,<span class="dv">2</span>]
fault1B_df$zState2 &lt;-<span class="st"> </span>fault1B_S2_mat[,<span class="dv">3</span>]
fault1B_df$xState3 &lt;-<span class="st"> </span>fault1B_S3_mat[,<span class="dv">1</span>]
fault1B_df$yState3 &lt;-<span class="st"> </span>fault1B_S3_mat[,<span class="dv">2</span>]
fault1B_df$zState3 &lt;-<span class="st"> </span>fault1B_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault1B_state1_df &lt;-<span class="st"> </span>fault1B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault1B_state2_df &lt;-<span class="st"> </span>fault1B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault1B_state3_df &lt;-<span class="st"> </span>fault1B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault1B_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault1B_state1_df,
                               fault1B_state2_df,
                               fault1B_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>We now look at the effect of Fault 1B on the scatterplot of the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault1B_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault1B_scatter-1.png" width="672"></p>
<p>The third fault we introduce (Fault 2A) is a drift in each feature by <span class="math inline">\(10 ^ {-3} * (\text{step} - 8500)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Fault 2A  ###
<span class="co"># Drift each &lt;x, y, z&gt; by (step - faultStart) / 10 ^ 3</span>
drift_vec &lt;-<span class="st"> </span>(<span class="dv">1</span>:omega -<span class="st"> </span>faultStart) /<span class="st"> </span><span class="dv">10</span> ^<span class="st"> </span><span class="dv">3</span>
drift_vec[drift_vec &lt;<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
fault2A_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, x, y, z) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> x +<span class="st"> </span>drift_vec,
         <span class="dt">y =</span> y +<span class="st"> </span>drift_vec,
         <span class="dt">z =</span> z +<span class="st"> </span>drift_vec)
fault2A_mat &lt;-<span class="st"> </span>fault2A_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault2A_S2_mat &lt;-<span class="st"> </span>fault2A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="co"># scatterplot3d(fault2A_S2_mat)</span>

<span class="co"># State 3</span>
fault2A_S3_mat &lt;-<span class="st"> </span>fault2A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="co"># scatterplot3d(fault2A_S3_mat)</span>

<span class="co"># Now concatenate these vectors</span>
fault2A_df$xState2 &lt;-<span class="st"> </span>fault2A_S2_mat[,<span class="dv">1</span>]
fault2A_df$yState2 &lt;-<span class="st"> </span>fault2A_S2_mat[,<span class="dv">2</span>]
fault2A_df$zState2 &lt;-<span class="st"> </span>fault2A_S2_mat[,<span class="dv">3</span>]
fault2A_df$xState3 &lt;-<span class="st"> </span>fault2A_S3_mat[,<span class="dv">1</span>]
fault2A_df$yState3 &lt;-<span class="st"> </span>fault2A_S3_mat[,<span class="dv">2</span>]
fault2A_df$zState3 &lt;-<span class="st"> </span>fault2A_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault2A_state1_df &lt;-<span class="st"> </span>fault2A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault2A_state2_df &lt;-<span class="st"> </span>fault2A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault2A_state3_df &lt;-<span class="st"> </span>fault2A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault2A_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault2A_state1_df,
                               fault2A_state2_df,
                               fault2A_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>Now we look at the scatterplot under this drift fault.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault2A_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault2A_scatter-1.png" width="672"></p>
<p>The fourth fault we introduce (Fault 2B) is a drift in features <span class="math inline">\(\textbf{y}\)</span> and <span class="math inline">\(\textbf{z}\)</span> by <span class="math inline">\(10 ^ {-3} * (\text{step} - 8500)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Fault 2B  ###
<span class="co"># Drift each &lt;y, z&gt; by (step - faultStart) / 10 ^ 3</span>
fault2B_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, x, y, z) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> y +<span class="st"> </span>drift_vec,
         <span class="dt">z =</span> z +<span class="st"> </span>drift_vec)
fault2B_mat &lt;-<span class="st"> </span>fault2B_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault2B_S2_mat &lt;-<span class="st"> </span>fault2B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="kw">scatterplot3d</span>(fault2B_S2_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault2B_intro-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># State 3</span>
fault2B_S3_mat &lt;-<span class="st"> </span>fault2B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="kw">scatterplot3d</span>(fault2B_S3_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault2B_intro-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now concatenate these vectors</span>
fault2B_df$xState2 &lt;-<span class="st"> </span>fault2B_S2_mat[,<span class="dv">1</span>]
fault2B_df$yState2 &lt;-<span class="st"> </span>fault2B_S2_mat[,<span class="dv">2</span>]
fault2B_df$zState2 &lt;-<span class="st"> </span>fault2B_S2_mat[,<span class="dv">3</span>]
fault2B_df$xState3 &lt;-<span class="st"> </span>fault2B_S3_mat[,<span class="dv">1</span>]
fault2B_df$yState3 &lt;-<span class="st"> </span>fault2B_S3_mat[,<span class="dv">2</span>]
fault2B_df$zState3 &lt;-<span class="st"> </span>fault2B_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault2B_state1_df &lt;-<span class="st"> </span>fault2B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault2B_state2_df &lt;-<span class="st"> </span>fault2B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault2B_state3_df &lt;-<span class="st"> </span>fault2B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault2B_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault2B_state1_df,
                               fault2B_state2_df,
                               fault2B_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>We now inspect the effect of Fault 2B.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault2B_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault2B_scatter-1.png" width="672"></p>
<p>Our fifth fault (Fault 3A) is to amplify the underlying <span class="math inline">\(\textbf{t}\)</span> signal vector as <span class="math inline">\(\frac{3}{2 * 10080} * (10080 - \text{step}) * \textbf{t}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Fault 3A  ###
<span class="co"># Amplify t for each &lt;x, y, z&gt; by 3 * (omega - step) * t / (2 * omega)</span>
amplify_vec &lt;-<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span>(<span class="dv">1</span>:omega -<span class="st"> </span>faultStart) /<span class="st"> </span>(omega -<span class="st"> </span>faultStart) +<span class="st"> </span><span class="dv">1</span>
amplify_vec[amplify_vec &lt;<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
fault3A_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, err1, err2, err3) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t =</span> amplify_vec *<span class="st"> </span>t) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> t +<span class="st"> </span>err1,
         <span class="dt">y =</span> t ^<span class="st"> </span><span class="dv">2</span> -<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t +<span class="st"> </span>err2,
         <span class="dt">z =</span> -t ^<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span>err3)
fault3A_mat &lt;-<span class="st"> </span>fault3A_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault3A_S2_mat &lt;-<span class="st"> </span>fault3A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="kw">scatterplot3d</span>(fault3A_S2_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault3A_intro-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># State 3</span>
fault3A_S3_mat &lt;-<span class="st"> </span>fault3A_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="kw">scatterplot3d</span>(fault3A_S3_mat)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault3A_intro-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now concatenate these vectors</span>
fault3A_df$xState2 &lt;-<span class="st"> </span>fault3A_S2_mat[,<span class="dv">1</span>]
fault3A_df$yState2 &lt;-<span class="st"> </span>fault3A_S2_mat[,<span class="dv">2</span>]
fault3A_df$zState2 &lt;-<span class="st"> </span>fault3A_S2_mat[,<span class="dv">3</span>]
fault3A_df$xState3 &lt;-<span class="st"> </span>fault3A_S3_mat[,<span class="dv">1</span>]
fault3A_df$yState3 &lt;-<span class="st"> </span>fault3A_S3_mat[,<span class="dv">2</span>]
fault3A_df$zState3 &lt;-<span class="st"> </span>fault3A_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault3A_state1_df &lt;-<span class="st"> </span>fault3A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault3A_state2_df &lt;-<span class="st"> </span>fault3A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault3A_state3_df &lt;-<span class="st"> </span>fault3A_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault3A_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault3A_state1_df,
                               fault3A_state2_df,
                               fault3A_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>Now inspect the effect of this fault</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault3A_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault3A_scatter-1.png" width="672"> Our last fault under consideration, Fault 3B, is a dampening fault to <span class="math inline">\(\textbf{t}\)</span> as <span class="math inline">\(\log \textbf{t}\)</span>. As <span class="math inline">\(\textbf{t}\)</span> is bdd within <span class="math inline">\([0.01, 2]\)</span>, <span class="math inline">\(\log\textbf{t}\in[-4.61, 0.7]\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Fault 3B  ###
<span class="co"># Dampen t for z by log|t|</span>
t_log &lt;-<span class="st"> </span>normal_df$t
t_log[faultStart:omega] &lt;-<span class="st"> </span><span class="kw">log</span>(t_log[faultStart:omega])
fault3B_df &lt;-<span class="st"> </span>normal_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, t, err1, err2, err3) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_damp =</span> t_log) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> t +<span class="st"> </span>err1,
         <span class="dt">y =</span> t ^<span class="st"> </span><span class="dv">2</span> -<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t +<span class="st"> </span>err2,
         <span class="dt">z =</span> -t_damp ^<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>t_damp ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span>err3)
fault3B_mat &lt;-<span class="st"> </span>fault3B_df %&gt;%<span class="st"> </span><span class="kw">select</span>(x,y,z) %&gt;%<span class="st"> </span>as.matrix

<span class="co"># State 2</span>
fault3B_S2_mat &lt;-<span class="st"> </span>fault3B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state2_angles,
                                                  <span class="dt">scale_factors =</span> state2_scales)
<span class="co"># scatterplot3d(fault3B_S2_mat)</span>

<span class="co"># State 3</span>
fault3B_S3_mat &lt;-<span class="st"> </span>fault3B_mat %*%<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/rotateScale3D.html">rotateScale3D</a></span>(<span class="dt">rot_angles =</span> state3_angles,
                                                  <span class="dt">scale_factors =</span> state3_scales)
<span class="co"># scatterplot3d(fault3B_S3_mat)</span>

<span class="co"># Now concatenate these vectors</span>
fault3B_df$xState2 &lt;-<span class="st"> </span>fault3B_S2_mat[,<span class="dv">1</span>]
fault3B_df$yState2 &lt;-<span class="st"> </span>fault3B_S2_mat[,<span class="dv">2</span>]
fault3B_df$zState2 &lt;-<span class="st"> </span>fault3B_S2_mat[,<span class="dv">3</span>]
fault3B_df$xState3 &lt;-<span class="st"> </span>fault3B_S3_mat[,<span class="dv">1</span>]
fault3B_df$yState3 &lt;-<span class="st"> </span>fault3B_S3_mat[,<span class="dv">2</span>]
fault3B_df$zState3 &lt;-<span class="st"> </span>fault3B_S3_mat[,<span class="dv">3</span>]

<span class="co"># Hourly switching process</span>
fault3B_state1_df &lt;-<span class="st"> </span>fault3B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, x, y, z)
fault3B_state2_df &lt;-<span class="st"> </span>fault3B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState2, <span class="dt">y =</span> yState2, <span class="dt">z =</span> zState2)
fault3B_state3_df &lt;-<span class="st"> </span>fault3B_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(state ==<span class="st"> </span><span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(dateTime, state, <span class="dt">x =</span> xState3, <span class="dt">y =</span> yState3, <span class="dt">z =</span> zState3)
fault3B_switch_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fault3B_state1_df,
                               fault3B_state2_df,
                               fault3B_state3_df) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(dateTime)</code></pre></div>
<p>We inspect the effect of the last fault on our scatterplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fault3B_switch_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(x, y, z) %&gt;%
<span class="st">  </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/fault3B_scatter-1.png" width="672"></p>
</div>
<div id="the-seven-data-frames" class="section level3">
<h3 class="hasAnchor">
<a href="#the-seven-data-frames" class="anchor"></a>The Seven Data Frames</h3>
<p>The normal_df data frame is without fault. We will remove rows 8500 to 10080, and replace these rows with the same rows from each each of the fault data frames. We then store each of these seven <code>xts</code> matrices in a list.</p>
<p>Implementation notes: turn all the data frames into <code>xts</code> objects for Kazor’s function to work, which we believe follows a depreciated version of <code>zoo</code>, so we need the <code>dateTime</code> column as the rownames of the data frame, not as an index. EDITED NOTE - B. Barnard and I rebuilt Kazor’s code as a functional package called <code>mvMonitoring</code>. The functions in these packages use <code>xts</code> matrices as inputs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(xts)</code></pre></div>
<pre><code>## Warning: package 'xts' was built under R version 3.4.1</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: 'zoo'</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: 'xts'</code></pre>
<pre><code>## The following objects are masked from 'package:dplyr':
## 
##     first, last</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_switch_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_switch_df[,-<span class="dv">1</span>],
                         <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(normal_switch_xts)</span>

<span class="co"># Fault 1A</span>
normal_w_fault1A_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                              fault1A_switch_df[faultStart:omega,])
fault1A_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault1A_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault1A_xts)</span>

<span class="co"># Fault 1B</span>
normal_w_fault1B_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                                 fault1B_switch_df[faultStart:omega,])
fault1B_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault1B_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault1B_xts)</span>

<span class="co"># Fault 2A</span>
normal_w_fault2A_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                                 fault2A_switch_df[faultStart:omega,])
fault2A_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault2A_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault2A_xts)</span>

<span class="co"># Fault 2B</span>
normal_w_fault2B_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                                 fault2B_switch_df[faultStart:omega,])
fault2B_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault2B_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault2B_xts)</span>

<span class="co"># Fault 3A</span>
normal_w_fault3A_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                                 fault3A_switch_df[faultStart:omega,])
fault3A_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault3A_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault3A_xts)</span>

<span class="co"># Fault 3B</span>
normal_w_fault3B_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(normal_switch_df[<span class="dv">1</span>:(faultStart -<span class="st"> </span><span class="dv">1</span>),],
                                 fault3B_switch_df[faultStart:omega,])
fault3B_xts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(normal_w_fault3B_df[,-<span class="dv">1</span>], <span class="dt">order.by =</span> normal_switch_df[,<span class="dv">1</span>])
<span class="co"># devtools::use_data(fault3B_xts)</span></code></pre></div>
<p>Now we clean up the environment, and load the data we’ve saved.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># uncomment these lines to use the data from the package. Comment them out</span>
<span class="co"># when generating new data.</span>
<span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())
<span class="kw">data</span>(<span class="st">"normal_switch_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault1A_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault1B_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault2A_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault2B_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault3A_xts"</span>)
<span class="kw">data</span>(<span class="st">"fault3B_xts"</span>)

faults_ls &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">normal =</span> normal_switch_xts,
                  <span class="dt">fault1A =</span> fault1A_xts,
                  <span class="dt">fault1B =</span> fault1B_xts,
                  <span class="dt">fault2A =</span> fault2A_xts,
                  <span class="dt">fault2B =</span> fault2B_xts,
                  <span class="dt">fault3A =</span> fault3A_xts,
                  <span class="dt">fault3B =</span> fault3B_xts)</code></pre></div>
</div>
<div id="feature-time-series-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-time-series-plots" class="anchor"></a>Feature Time-series Plots</h3>
<p>Now that we’ve created and stored these feature, we can use time-series plots to confirm our multi-state vision as well as quickly ascertain the fault behavior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Double check that faults are visible and according to plan:</span>
<span class="co"># faults_ls$fault1A %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault1A %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault1A %&gt;% select(z) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault1B %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault1B %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault1B %&gt;% select(z) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2A %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2A %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2A %&gt;% select(z) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2B %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2B %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault2B %&gt;% select(z) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3A %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3A %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3A %&gt;% select(z) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3B %&gt;% select(x) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3B %&gt;% select(y) %&gt;% plot.ts()</span>
<span class="co"># faults_ls$fault3B %&gt;% select(z) %&gt;% plot.ts()</span>
faults_ls$normal$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$normal$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$normal$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1A$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1A$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-5.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1A$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-6.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1B$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>() </code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-7.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1B$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-8.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault1B$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-9.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2A$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-10.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2A$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-11.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2A$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-12.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2B$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-13.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2B$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-14.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault2B$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-15.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3A$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-16.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3A$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-17.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3A$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-18.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3B$x %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-19.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3B$y %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-20.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faults_ls$fault3B$z %&gt;%<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/feature_ts_plots-21.png" width="672"></p>
</div>
</div>
<div id="multi-state-ad-pca-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-state-ad-pca-implementation" class="anchor"></a>Multi-State AD-PCA Implementation</h2>
<p>We now throw all this data we’ve just generated into our package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.time</span>()</code></pre></div>
<pre><code>## [1] "2017-07-07 13:29:46 CDT"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_ls &lt;-<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> faults_ls$normal[<span class="dv">1</span>:<span class="dv">8640</span>, <span class="dv">2</span>:<span class="dv">4</span>],
                         <span class="dt">labelVector =</span> faults_ls$normal[<span class="dv">1</span>:<span class="dv">8640</span>, <span class="dv">1</span>],
                         <span class="dt">trainObs =</span> <span class="dv">5</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                         <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                         <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                         <span class="dt">faultsToTriggerAlarm =</span> <span class="dv">3</span>,
                         <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>,
                         <span class="dt">var.amnt =</span> <span class="fl">0.95</span>)
<span class="kw">Sys.time</span>() <span class="co"># 14 seconds for 720 train, 360 update; 5 seconds for 1440, 720;</span></code></pre></div>
<pre><code>## [1] "2017-07-07 13:29:48 CDT"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1 second for 2880 train (two days), and 1440 update (one day).</span>

<span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
(falseAlarmRate_SPE &lt;-<span class="st"> </span><span class="kw">sum</span>(results_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) /
<span class="st">  </span><span class="kw">nrow</span>(results_ls$FaultChecks))</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The SPE false alarm rate hits 0 at alpha = 0.07.</span>
(falseAlarmRate_T2 &lt;-<span class="st"> </span><span class="kw">sum</span>(results_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) /
<span class="st">  </span><span class="kw">nrow</span>(results_ls$FaultChecks))</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The T2 false alarm rate hits 0 at alpha = 0.00015, and is at 16% at 0.07. The</span>
<span class="co"># T2 statistic throws too many false alarms for my taste.</span>
<span class="co"># These values were before we split the update observations by a third. These</span>
<span class="co"># false alarm rates increased dramatically (0.19, 0.41), so we increased the</span>
<span class="co"># number of training observations to 4320 (three days worth, up from 2880). The</span>
<span class="co"># false alarm rates dropped back, but not nearly as low (0.0031, 0.0884).</span>

results_ls$TrainingSpecs[[<span class="dv">2</span>]]$SPE_threshold</code></pre></div>
<pre><code>##   99.9% 
## 1.07521</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Apparently, the SPE function is VERY sensitive to the change in the var.amnt</span>
<span class="co"># parameter (defaults to 95%). At 0.95, the threshold is around 1.2-1.4. The</span>
<span class="co"># closer this parameter is to 1, the lower the SPE threshold (overfitting?).</span>
<span class="co"># This causes the abnormally high false alarm rate for state 2. However, when I</span>
<span class="co"># drop var.amnt even to 94%, the threshold increases drastically (to between 18</span>
<span class="co"># and 20); and if I increase var.amnt to 99%, the threshold drops to about</span>
<span class="co"># 0.6-0.7. I need to speak with Dr. Hering about this.</span>

<span class="co"># I think that right around 94% is the cutoff to include or not include one of</span>
<span class="co"># the features, so we have almost a 0-1 loss cutoff there. Features aren't</span>
<span class="co"># continuous, so I'm not sure the best course of action here.</span></code></pre></div>
</div>
<div id="test-the-multi-state-monitoring-function" class="section level2">
<h2 class="hasAnchor">
<a href="#test-the-multi-state-monitoring-function" class="anchor"></a>Test the Multi-State Monitoring function</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create six observations with lags 0:2 included</span>
laggedTestObs &lt;-<span class="st"> </span>faults_ls$normal[<span class="dv">8639</span>:<span class="dv">10080</span>, -<span class="dv">1</span>]
laggedTestObs &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/diff">lag.xts</a></span>(laggedTestObs, <span class="dv">0</span>:<span class="dv">2</span>)
laggedTestObs &lt;-<span class="st"> </span>laggedTestObs[-(<span class="dv">1</span>:<span class="dv">2</span>),]
laggedTestObs &lt;-<span class="st"> </span><span class="kw">cbind</span>(faults_ls$normal[<span class="dv">8641</span>:<span class="dv">10080</span>, <span class="dv">1</span>], laggedTestObs)
testDataandFlags &lt;-<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> laggedTestObs[,-<span class="dv">1</span>],
           <span class="dt">labelVector =</span> laggedTestObs[,<span class="dv">1</span>],
           <span class="dt">trainingSummary =</span> results_ls$TrainingSpecs)
testDataandFlags[<span class="dv">1</span>:<span class="dv">5</span>,]</code></pre></div>
<pre><code>##                             x         y         z       x.1        y.1
## 2016-12-03 00:00:00 0.3673186 -1.403877 0.6956765 0.3394348  0.1052113
## 2016-12-03 00:01:00 0.5559263 -1.290867 0.5356897 0.3673186 -1.4038775
## 2016-12-03 00:02:00 0.5777657 -1.138814 0.3775012 0.5559263 -1.2908668
## 2016-12-03 00:03:00 0.3750929 -1.109280 0.8224853 0.5777657 -1.1388141
## 2016-12-03 00:04:00 0.6498401 -1.564436 0.8744643 0.3750929 -1.1092802
##                           z.1       x.2         y.2       z.2       SPE
## 2016-12-03 00:00:00 0.4710548 0.3060828  0.08919818 0.2320369 1.3348413
## 2016-12-03 00:01:00 0.6956765 0.3394348  0.10521135 0.4710548 1.8497609
## 2016-12-03 00:02:00 0.5356897 0.3673186 -1.40387746 0.6956765 0.2139396
## 2016-12-03 00:03:00 0.3775012 0.5559263 -1.29086684 0.5356897 0.1402789
## 2016-12-03 00:04:00 0.8224853 0.5777657 -1.13881413 0.3775012 0.3599315
##                     SPE_Flag        T2 T2_Flag Alarm
## 2016-12-03 00:00:00        0 14.950163       0    NA
## 2016-12-03 00:01:00        0  8.620167       0    NA
## 2016-12-03 00:02:00        0  2.789033       0    NA
## 2016-12-03 00:03:00        0  3.335855       0    NA
## 2016-12-03 00:04:00        0  2.338216       0    NA</code></pre>
</div>
<div id="test-the-warning-function" class="section level2">
<h2 class="hasAnchor">
<a href="#test-the-warning-function" class="anchor"></a>Test the Warning function</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This line will test if the function can check the last line at all.</span>
mvMonitoring::<span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(testDataandFlags[<span class="dv">1</span>,])</code></pre></div>
<pre><code>##                    x         y         z       x.1       y.1       z.1
## 2016-12-03 0.3673186 -1.403877 0.6956765 0.3394348 0.1052113 0.4710548
##                  x.2        y.2       z.2      SPE SPE_Flag       T2
## 2016-12-03 0.3060828 0.08919818 0.2320369 1.334841        0 14.95016
##            T2_Flag Alarm
## 2016-12-03       0    NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># These lines will test each line as if it was just received:</span>
alarmData &lt;-<span class="st"> </span>testDataandFlags
for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(testDataandFlags)){
  alarmData[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span>mvMonitoring::<span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(alarmData[<span class="dv">1</span>:i,])
}

<span class="co"># False Alarms? </span>
alarmData[,<span class="kw">ncol</span>(alarmData)] %&gt;%<span class="st"> </span><span class="kw">sum</span>(<span class="dt">na.rm =</span> T)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alarmData[,(<span class="kw">ncol</span>(alarmData) -<span class="st"> </span><span class="dv">4</span>):<span class="kw">ncol</span>(alarmData)] %&gt;%<span class="st"> </span>head</code></pre></div>
<pre><code>##                           SPE SPE_Flag        T2 T2_Flag Alarm
## 2016-12-03 00:00:00 1.3348413        0 14.950163       0    NA
## 2016-12-03 00:01:00 1.8497609        0  8.620167       0    NA
## 2016-12-03 00:02:00 0.2139396        0  2.789033       0    NA
## 2016-12-03 00:03:00 0.1402789        0  3.335855       0    NA
## 2016-12-03 00:04:00 0.3599315        0  2.338216       0     0
## 2016-12-03 00:05:00 0.2986895        0  2.279194       0     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alarmData[,(<span class="kw">ncol</span>(alarmData) -<span class="st"> </span><span class="dv">4</span>):<span class="kw">ncol</span>(alarmData)] %&gt;%<span class="st"> </span>tail</code></pre></div>
<pre><code>##                            SPE SPE_Flag       T2 T2_Flag Alarm
## 2016-12-03 23:54:00 0.11528639        0 2.945911       0     0
## 2016-12-03 23:55:00 0.04699384        0 2.958168       0     0
## 2016-12-03 23:56:00 0.06766394        0 2.552365       0     0
## 2016-12-03 23:57:00 0.22902449        0 3.065520       0     0
## 2016-12-03 23:58:00 0.25658468        0 3.394858       0     0
## 2016-12-03 23:59:00 0.45816256        0 3.674280       0     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># What do the first three hours look like? What did it look like right before?</span>
<span class="co"># Before</span>
faults_ls$normal[<span class="dv">8461</span>:<span class="dv">8640</span>, <span class="dv">2</span>:<span class="dv">4</span>] %&gt;%<span class="st"> </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/test-warning-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># After</span>
alarmData[<span class="dv">1</span>:<span class="dv">180</span>,<span class="dv">2</span>:<span class="dv">4</span>] %&gt;%<span class="st"> </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/test-warning-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># I'm not seeing much difference - even the scales are the same. Let's look</span>
<span class="co"># specifically at state 2:</span>
<span class="co"># Before</span>
faults_ls$normal[<span class="dv">8521</span>:<span class="dv">8580</span>, <span class="dv">2</span>:<span class="dv">4</span>] %&gt;%<span class="st"> </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/test-warning-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># After</span>
alarmData[<span class="dv">61</span>:<span class="dv">120</span>,<span class="dv">2</span>:<span class="dv">4</span>] %&gt;%<span class="st"> </span><span class="kw">scatterplot3d</span>()</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/test-warning-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We are seeing a lot of false alarms in state 2 under NOC, but few to no false</span>
<span class="co"># alarms in states 1 an 3</span>
<span class="co"># faults_ls$normal[faults_ls$normal[,1] == 2, 2] %&gt;% plot.xts()</span>
<span class="co"># faults_ls$normal[faults_ls$normal[,1] == 2, 3] %&gt;% plot.xts()</span>
<span class="co"># faults_ls$normal[faults_ls$normal[,1] == 2, 4] %&gt;% plot.xts()</span>
<span class="co"># faults_ls$normal[faults_ls$normal[,1] == 2, 2:4] %&gt;% scatterplot3d()</span></code></pre></div>
</div>
<div id="real-data" class="section level1">
<h1 class="hasAnchor">
<a href="#real-data" class="anchor"></a>Real Data</h1>
<p>This data was sent to use from Kate Newhart in Golden, CO.</p>
<div id="import-the-data-files" class="section level3">
<h3 class="hasAnchor">
<a href="#import-the-data-files" class="anchor"></a>Import the Data files</h3>
<p>First, we import the two data sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># # If you start working in the vignette here, then load these.</span>
<span class="co"># # Otherwise, they were loaded on lines 88 and 529, respectively</span>
<span class="co"># library(magrittr)</span>
<span class="co"># library(tidyverse) # Includes readr</span>
<span class="co"># library(mvMonitoring)</span>
<span class="co"># library(xts)</span>
if(.Platform$OS.type ==<span class="st"> "windows"</span>){
  tenDayData_v2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"~/GitHub/mvMonitoring/mvMonitoring/inst/tenDayData_v2.csv"</span>, 
  <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">X1 =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)))
currentDayData_v2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"~/GitHub/mvMonitoring/mvMonitoring/inst/currentDayData_v2.csv"</span>, 
  <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">X1 =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)))
}else{
  tenDayData_v2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"~/Documents/GitHub/mvMonitoring/inst/tenDayData_v2.csv"</span>, 
                <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">X1 =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)))
currentDayData_v2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"~/Documents/GitHub/mvMonitoring/inst/currentDayData_v2.csv"</span>,
                <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">X1 =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)))
}</code></pre></div>
<pre><code>## Warning: Missing column names filled in: 'X1' [1]

## Warning: Missing column names filled in: 'X1' [1]</code></pre>
<p>The first data set is of a 10-day period, and the second data set is from a single day. The first columns of each data set are DateTime columns. Now we can do some basic data exploration, and save the data sets as <code>xts</code> matrices. Because <code>readr</code> imports the data frame as a tibble, we use list subsetting to get at the index column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(tenDayData_v2, <span class="dt">give.attr =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    1437 obs. of  37 variables:
##  $ X1                                      : POSIXct, format: "2017-01-17 00:09:59" "2017-01-17 00:19:56" ...
##  $ AMBIENT_TEMP.PROCESS_VALUE              : int  57 57 57 57 57 57 57 57 57 57 ...
##  $ BIO_1.LEVEL.PROCESS_VALUE               : num  5.09 4.97 4.95 5.23 5.28 ...
##  $ BIO_1.TEMPERATURE.PROCESS_VALUE         : int  58 58 58 58 58 58 58 58 58 58 ...
##  $ BIO_1.TSS.PROCESS_VALUE                 : num  4419 4523 4428 4267 4173 ...
##  $ BIO_2.LEVEL.PROCESS_VALUE               : num  5.93 5.93 5.96 5.8 5.78 ...
##  $ BIO_2.TEMPERATURE.PROCESS_VALUE         : int  61 61 61 61 61 61 61 61 61 61 ...
##  $ BIO_2.TSS.PROCESS_VALUE                 : num  4418 4456 4489 4108 4388 ...
##  $ BIO_BLOWER_1.FLOW.PROCESS_VALUE         : num  23.95 0.1 0.1 5.35 29.34 ...
##  $ BIO_BLOWER_2.FLOW.PROCESS_VALUE         : num  0 5.22 20.94 0.02 0.01 ...
##  $ MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1 : num  5.42 5 5.71 5.2 5.36 ...
##  $ MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2 : num  5.04 5.56 4.84 5.34 5.2 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE    : num  3.72 3.71 3.72 3.75 3.72 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1  : num  1.88 1.72 1.96 1.82 1.85 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2  : num  1.81 1.99 1.73 1.92 1.87 ...
##  $ MBR.BATCH_VOLUME                        : num  148 148 177 206 206 ...
##  $ MBR_1.INF_FLOW.PROCESS_VALUE            : num  10.38 9.94 9.97 10.21 10.21 ...
##  $ MBR_1.LEVEL.PROCESS_VALUE               : num  9.87 9.88 9.86 9.88 9.87 ...
##  $ MBR_1.PERM_FLOW.PROCESS_VALUE           : num  2.82 0 0 0 0 ...
##  $ MBR_1.PERM_PRESS.PROCESS_VALUE          : num  10.1 12.5 12.4 12.4 12.4 ...
##  $ MBR_1.TRANS_PRESS.PROCESS_VALUE         : num  4.1 1.64 1.7 1.7 1.7 ...
##  $ MBR_2.INF_FLOW.PROCESS_VALUE            : num  8.41 9.23 9.83 10.04 10.13 ...
##  $ MBR_2.LEVEL.PROCESS_VALUE               : num  9.99 10 9.97 9.99 10.01 ...
##  $ MBR_2.PERM_FLOW.PROCESS_VALUE           : num  2.75 0 0 0 0 ...
##  $ MBR_2.PERM_PRESS.PROCESS_VALUE          : num  11.4 13.6 13.6 13.6 13.6 ...
##  $ MBR_2.TRANS_PRESS.PROCESS_VALUE         : num  2.74 0.4 0.4 0.4 0.4 ...
##  $ PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE: num  808 808 807 808 806 ...
##  $ PERMEATE_TANK.LEVEL.PROCESS_VALUE       : num  3.12 3.07 3.05 3.07 3.06 ...
##  $ PERMEATE_TANK.TURBIDITY.PROCESS_VALUE   : num  0.1193 0.0153 0.0119 0.0133 0.0122 ...
##  $ RAS_TROUGH.DO.PROCESS_VALUE             : num  7.6 7.6 7.6 7.6 7.6 ...
##  $ RAS_TROUGH.PH.PROCESS_VALUE             : num  6.5 6.6 6.6 6.6 6.6 ...
##  $ RAS_TROUGH.TEMPERATURE.PROCESS_VALUE    : num  67 67 67 67 67 67 67 67 67 67 ...
##  $ RAS_TROUGH.TSS.PROCESS_VALUE            : num  4682 4427 4400 4306 4275 ...
##  $ SEWAGE.FLOW.PROCESS_VALUE               : num  0 0 11.75 2.98 0 ...
##  $ SEWAGE.FLOW.TOTAL_BATCH                 : num  153 153 107 152 153 ...
##  $ SEWAGE.LEVEL.PROCESS_VALUE              : num  2.88 2.87 2.83 2.8 2.85 ...
##  $ WAS_FLOW.PROCESS_VALUE                  : num  0 0 0.389 0 0 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tenDay &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(tenDayData_v2[, -<span class="dv">1</span>], <span class="dt">order.by =</span> tenDayData_v2[[<span class="dv">1</span>]])
tenDay[<span class="kw">nrow</span>(tenDay),]</code></pre></div>
<pre><code>## Warning: timezone of object (UTC) is different than current timezone ().</code></pre>
<pre><code>##                     AMBIENT_TEMP.PROCESS_VALUE BIO_1.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                         51                      5.16
##                     BIO_1.TEMPERATURE.PROCESS_VALUE
## 2017-01-26 23:59:55                              56
##                     BIO_1.TSS.PROCESS_VALUE BIO_2.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                    4590                      5.88
##                     BIO_2.TEMPERATURE.PROCESS_VALUE
## 2017-01-26 23:59:55                              59
##                     BIO_2.TSS.PROCESS_VALUE
## 2017-01-26 23:59:55                    5056
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                            9.32
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                               0
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1
## 2017-01-26 23:59:55                                4.904202
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2
## 2017-01-26 23:59:55                                5.851261
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE
## 2017-01-26 23:59:55                             3.741176
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1
## 2017-01-26 23:59:55                                1.70084
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2
## 2017-01-26 23:59:55                               2.040336
##                     MBR.BATCH_VOLUME MBR_1.INF_FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55          219.912                         9.69
##                     MBR_1.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                     9.868
##                     MBR_1.PERM_FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                      2.932773
##                     MBR_1.PERM_PRESS.PROCESS_VALUE
## 2017-01-26 23:59:55                       14.11765
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE
## 2017-01-26 23:59:55                      0.08403361
##                     MBR_2.INF_FLOW.PROCESS_VALUE MBR_2.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                         8.94                     9.977
##                     MBR_2.PERM_FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                      2.876471
##                     MBR_2.PERM_PRESS.PROCESS_VALUE
## 2017-01-26 23:59:55                       13.93277
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE
## 2017-01-26 23:59:55                       0.2478992
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE
## 2017-01-26 23:59:55                                      781
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                              3.07
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE
## 2017-01-26 23:59:55                                0.0331
##                     RAS_TROUGH.DO.PROCESS_VALUE
## 2017-01-26 23:59:55                           0
##                     RAS_TROUGH.PH.PROCESS_VALUE
## 2017-01-26 23:59:55                         6.4
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE
## 2017-01-26 23:59:55                                   58
##                     RAS_TROUGH.TSS.PROCESS_VALUE SEWAGE.FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                         4445                         0
##                     SEWAGE.FLOW.TOTAL_BATCH SEWAGE.LEVEL.PROCESS_VALUE
## 2017-01-26 23:59:55                202.5602                      2.908
##                     WAS_FLOW.PROCESS_VALUE
## 2017-01-26 23:59:55                      0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(currentDayData_v2, <span class="dt">give.attr =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    75 obs. of  37 variables:
##  $ X1                                      : POSIXct, format: "2017-01-27 00:09:57" "2017-01-27 00:19:59" ...
##  $ AMBIENT_TEMP.PROCESS_VALUE              : int  51 50 50 50 50 50 50 50 50 50 ...
##  $ BIO_1.LEVEL.PROCESS_VALUE               : num  5.04 4.97 5.35 5.4 5.37 ...
##  $ BIO_1.TEMPERATURE.PROCESS_VALUE         : int  56 56 56 56 56 56 56 56 56 56 ...
##  $ BIO_1.TSS.PROCESS_VALUE                 : int  4781 4769 4841 4618 4519 4441 4705 4488 4184 4218 ...
##  $ BIO_2.LEVEL.PROCESS_VALUE               : num  5.87 5.9 5.73 5.71 5.69 ...
##  $ BIO_2.TEMPERATURE.PROCESS_VALUE         : int  59 59 59 59 59 59 59 59 59 59 ...
##  $ BIO_2.TSS.PROCESS_VALUE                 : num  5142 5130 5052 4674 4857 ...
##  $ BIO_BLOWER_1.FLOW.PROCESS_VALUE         : num  0.1 0.1 19.68 7.63 0.1 ...
##  $ BIO_BLOWER_2.FLOW.PROCESS_VALUE         : num  13.81 9.45 0 0.01 17.42 ...
##  $ MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1 : num  5.42 5.47 4.97 5.82 4.8 ...
##  $ MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2 : num  5.27 5.24 5.74 4.88 5.66 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE    : num  3.73 3.73 3.75 3.73 3.73 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1  : num  1.88 1.9 1.73 2.03 1.66 ...
##  $ MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2  : num  1.85 1.83 2.01 1.71 1.97 ...
##  $ MBR.BATCH_VOLUME                        : num  220 188 184 184 184 ...
##  $ MBR_1.INF_FLOW.PROCESS_VALUE            : num  9.46 9.72 9.7 9.69 9.66 ...
##  $ MBR_1.LEVEL.PROCESS_VALUE               : num  9.86 9.84 9.88 9.87 9.87 ...
##  $ MBR_1.PERM_FLOW.PROCESS_VALUE           : num  1.88 0 0 0 0 ...
##  $ MBR_1.PERM_PRESS.PROCESS_VALUE          : num  14.3 14.6 14.6 14.6 14.6 ...
##  $ MBR_1.TRANS_PRESS.PROCESS_VALUE         : num  0.0513 0 0 0 0 ...
##  $ MBR_2.INF_FLOW.PROCESS_VALUE            : num  9.48 9.83 10.06 10.09 9.96 ...
##  $ MBR_2.LEVEL.PROCESS_VALUE               : num  9.98 9.94 9.99 9.99 9.98 ...
##  $ MBR_2.PERM_FLOW.PROCESS_VALUE           : num  2.191 0.929 0.929 0.932 0.927 ...
##  $ MBR_2.PERM_PRESS.PROCESS_VALUE          : num  14.1 14.3 14.3 14.3 14.3 ...
##  $ MBR_2.TRANS_PRESS.PROCESS_VALUE         : num  0.157 0 0 0 0 ...
##  $ PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE: num  782 782 782 781 781 ...
##  $ PERMEATE_TANK.LEVEL.PROCESS_VALUE       : num  3.13 3.08 3.07 3.07 3.08 ...
##  $ PERMEATE_TANK.TURBIDITY.PROCESS_VALUE   : num  0.0364 0.0335 0.0497 0.0592 0.0595 ...
##  $ RAS_TROUGH.DO.PROCESS_VALUE             : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ RAS_TROUGH.PH.PROCESS_VALUE             : num  6.4 6.5 6.6 6.5 6.4 ...
##  $ RAS_TROUGH.TEMPERATURE.PROCESS_VALUE    : int  58 58 58 58 58 58 58 58 58 58 ...
##  $ RAS_TROUGH.TSS.PROCESS_VALUE            : num  4254 4208 3970 4007 4039 ...
##  $ SEWAGE.FLOW.PROCESS_VALUE               : num  0 19.7 0 0 0 ...
##  $ SEWAGE.FLOW.TOTAL_BATCH                 : num  203 124 203 203 203 ...
##  $ SEWAGE.LEVEL.PROCESS_VALUE              : num  2.9 2.78 2.82 2.87 2.88 ...
##  $ WAS_FLOW.PROCESS_VALUE                  : num  0 0.468 0 0 0 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oneDay &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(currentDayData_v2[, -<span class="dv">1</span>], <span class="dt">order.by =</span> currentDayData_v2[[<span class="dv">1</span>]])
oneDay[<span class="dv">1</span>,]</code></pre></div>
<pre><code>## Warning: timezone of object (UTC) is different than current timezone ().</code></pre>
<pre><code>##                     AMBIENT_TEMP.PROCESS_VALUE BIO_1.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                         51                     5.045
##                     BIO_1.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                              56
##                     BIO_1.TSS.PROCESS_VALUE BIO_2.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                    4781                     5.875
##                     BIO_2.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                              59
##                     BIO_2.TSS.PROCESS_VALUE
## 2017-01-27 00:09:57                  5142.5
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                             0.1
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                        13.80909
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1
## 2017-01-27 00:09:57                                5.417949
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2
## 2017-01-27 00:09:57                                5.271795
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE
## 2017-01-27 00:09:57                             3.733333
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1
## 2017-01-27 00:09:57                               1.883761
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2
## 2017-01-27 00:09:57                               1.849573
##                     MBR.BATCH_VOLUME MBR_1.INF_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57          219.912                     9.463637
##                     MBR_1.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                  9.861818
##                     MBR_1.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                      1.879487
##                     MBR_1.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                       14.33333
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                      0.05128205
##                     MBR_2.INF_FLOW.PROCESS_VALUE MBR_2.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                     9.481818                  9.976363
##                     MBR_2.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                      2.191453
##                     MBR_2.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                       14.07094
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                        0.157265
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE
## 2017-01-27 00:09:57                                    782.5
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                              3.13
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE
## 2017-01-27 00:09:57                            0.03636364
##                     RAS_TROUGH.DO.PROCESS_VALUE
## 2017-01-27 00:09:57                           0
##                     RAS_TROUGH.PH.PROCESS_VALUE
## 2017-01-27 00:09:57                         6.4
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                                   58
##                     RAS_TROUGH.TSS.PROCESS_VALUE SEWAGE.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                       4253.5                         0
##                     SEWAGE.FLOW.TOTAL_BATCH SEWAGE.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                202.5602                   2.902727
##                     WAS_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                      0</code></pre>
</div>
<div id="clean-and-save-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-and-save-the-data" class="anchor"></a>Clean and Save the Data</h3>
<p>We see that the <code>oneDay</code> data matrix is adjacent to the last observation from the <code>tenDay</code> data matrix. Now we check the data matrices for NA values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anyNA</span>(tenDay)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anyNA</span>(oneDay)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>The ten day data set contains NA values, so we need to deal with these. We also must check for constant or near-constant data vectors. These vectors will cause the eigendecomposition to fail.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Any constant columns? Columns with the same values can cause singularity issues.</span>
<span class="kw">sapply</span>(<span class="dv">1</span>:<span class="kw">ncol</span>(tenDay), function(i){
  <span class="kw">length</span>(<span class="kw">unique</span>(tenDay[,i])) &lt;<span class="st"> </span><span class="dv">20</span>
})</code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
## [34] FALSE FALSE FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># From this, we see that columns 3, 6, 29, and 30 put us at risk of singularity</span>
<span class="co"># issues.</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>(tenDay[,<span class="dv">3</span>])</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/rmNA-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>(tenDay[,<span class="dv">6</span>])</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/rmNA-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>(tenDay[,<span class="dv">29</span>])</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/rmNA-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/plot.xts">plot.xts</a></span>(tenDay[,<span class="dv">30</span>])</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/rmNA-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We necessarily remove column 29, as it is constant for multiple entire updates</span>
tenDay_clean &lt;-<span class="st"> </span>tenDay[,-<span class="dv">29</span>]
oneDay_clean &lt;-<span class="st"> </span>oneDay[,-<span class="dv">29</span>]

<span class="co"># Now we remove the rows with NA observations</span>
tenDay_clean &lt;-<span class="st"> </span><span class="kw">na.omit</span>(tenDay_clean)
<span class="kw">nrow</span>(tenDay) -<span class="st"> </span><span class="kw">nrow</span>(tenDay_clean)</code></pre></div>
<pre><code>## [1] 138</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># devtools::use_data(oneDay_clean)</span>
<span class="co"># devtools::use_data(tenDay_clean)</span></code></pre></div>
<p>The clean data frame has 138 fewer observations.</p>
</div>
<div id="training-the-ad-pca-model" class="section level3">
<h3 class="hasAnchor">
<a href="#training-the-ad-pca-model" class="anchor"></a>Training the AD-PCA Model</h3>
<p>Now to analyse the training data, and pass the training information in order to test the testing data. Because the data do not come from a process with recorded state variables (or, more specifically, that we do not have such state information), we will give a column of 1s as the labels. Futher, we have ten days’ worth of 10-minute-level observations, so we will train on <span class="math inline">\(7 * 24 * 60 / 10 = 1008\)</span> observations (seven days’ worth), and update each day (<span class="math inline">\(24 * 60 * 10 = 144\)</span>). Further, we will lag the features by one time step. CAVEAT: we’re missing one observation: the <code>tenDay_clean</code> data matrix had 1299 rows, while our train (864) and returned faultChecks (434) account for 1298 rows. This missing row is the row we lost due to the lag.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tenDayResults_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> tenDay_clean,
                         <span class="dt">labelVector =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tenDay_clean)),
                         <span class="dt">trainObs =</span> <span class="dv">1008</span>,
                         <span class="dt">updateFreq =</span> <span class="dv">144</span>,
                         <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                         <span class="dt">faultsToTriggerAlarm =</span> <span class="dv">3</span>,
                         <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">1</span>,
                         <span class="dt">var.amnt =</span> <span class="fl">0.95</span>)</code></pre></div>
</div>
<div id="testing-the-new-observations" class="section level3">
<h3 class="hasAnchor">
<a href="#testing-the-new-observations" class="anchor"></a>Testing the New Observations</h3>
<p>We will test the observations from the <code>oneDay_clean</code> data set. We must first lag the test observations. We’ll borrow the lags we don’t have from the previous day (in <code>nineDay_clean</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">laggedOneDay &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/diff">lag.xts</a></span>(oneDay_clean, <span class="dv">0</span>:<span class="dv">1</span>)
laggedOneDay[<span class="dv">1</span>,<span class="dv">36</span>:<span class="dv">70</span>] &lt;-<span class="st"> </span>tenDay_clean[<span class="kw">nrow</span>(tenDay_clean),]

realDataandFlags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> laggedOneDay,
                               <span class="dt">labelVector =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(laggedOneDay)),
                               <span class="dt">trainingSummary =</span> tenDayResults_ls$TrainingSpecs)
realDataandFlags[<span class="dv">1</span>,]</code></pre></div>
<pre><code>## Warning: timezone of object (UTC) is different than current timezone ().</code></pre>
<pre><code>##                     AMBIENT_TEMP.PROCESS_VALUE BIO_1.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                         51                     5.045
##                     BIO_1.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                              56
##                     BIO_1.TSS.PROCESS_VALUE BIO_2.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                    4781                     5.875
##                     BIO_2.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                              59
##                     BIO_2.TSS.PROCESS_VALUE
## 2017-01-27 00:09:57                  5142.5
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                             0.1
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                        13.80909
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1
## 2017-01-27 00:09:57                                5.417949
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2
## 2017-01-27 00:09:57                                5.271795
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE
## 2017-01-27 00:09:57                             3.733333
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1
## 2017-01-27 00:09:57                               1.883761
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2
## 2017-01-27 00:09:57                               1.849573
##                     MBR.BATCH_VOLUME MBR_1.INF_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57          219.912                     9.463637
##                     MBR_1.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                  9.861818
##                     MBR_1.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                      1.879487
##                     MBR_1.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                       14.33333
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                      0.05128205
##                     MBR_2.INF_FLOW.PROCESS_VALUE MBR_2.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                     9.481818                  9.976363
##                     MBR_2.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                      2.191453
##                     MBR_2.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                       14.07094
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 00:09:57                        0.157265
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE
## 2017-01-27 00:09:57                                    782.5
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                              3.13
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE
## 2017-01-27 00:09:57                            0.03636364
##                     RAS_TROUGH.PH.PROCESS_VALUE
## 2017-01-27 00:09:57                         6.4
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 00:09:57                                   58
##                     RAS_TROUGH.TSS.PROCESS_VALUE SEWAGE.FLOW.PROCESS_VALUE
## 2017-01-27 00:09:57                       4253.5                         0
##                     SEWAGE.FLOW.TOTAL_BATCH SEWAGE.LEVEL.PROCESS_VALUE
## 2017-01-27 00:09:57                202.5602                   2.902727
##                     WAS_FLOW.PROCESS_VALUE AMBIENT_TEMP.PROCESS_VALUE.1
## 2017-01-27 00:09:57                      0                           51
##                     BIO_1.LEVEL.PROCESS_VALUE.1
## 2017-01-27 00:09:57                        5.16
##                     BIO_1.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                56
##                     BIO_1.TSS.PROCESS_VALUE.1 BIO_2.LEVEL.PROCESS_VALUE.1
## 2017-01-27 00:09:57                      4590                        5.88
##                     BIO_2.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                59
##                     BIO_2.TSS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                      5056
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                              9.32
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                 0
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1.1
## 2017-01-27 00:09:57                                  4.904202
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2.1
## 2017-01-27 00:09:57                                  5.851261
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE.1
## 2017-01-27 00:09:57                               3.741176
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1.1
## 2017-01-27 00:09:57                                  1.70084
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2.1
## 2017-01-27 00:09:57                                 2.040336
##                     MBR.BATCH_VOLUME.1 MBR_1.INF_FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57            219.912                           9.69
##                     MBR_1.LEVEL.PROCESS_VALUE.1
## 2017-01-27 00:09:57                       9.868
##                     MBR_1.PERM_FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                        2.932773
##                     MBR_1.PERM_PRESS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                         14.11765
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                        0.08403361
##                     MBR_2.INF_FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                           8.94
##                     MBR_2.LEVEL.PROCESS_VALUE.1
## 2017-01-27 00:09:57                       9.977
##                     MBR_2.PERM_FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                        2.876471
##                     MBR_2.PERM_PRESS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                         13.93277
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                         0.2478992
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                        781
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                3.07
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                  0.0331
##                     RAS_TROUGH.PH.PROCESS_VALUE.1
## 2017-01-27 00:09:57                           6.4
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 00:09:57                                     58
##                     RAS_TROUGH.TSS.PROCESS_VALUE.1
## 2017-01-27 00:09:57                           4445
##                     SEWAGE.FLOW.PROCESS_VALUE.1 SEWAGE.FLOW.TOTAL_BATCH.1
## 2017-01-27 00:09:57                           0                  202.5602
##                     SEWAGE.LEVEL.PROCESS_VALUE.1 WAS_FLOW.PROCESS_VALUE.1
## 2017-01-27 00:09:57                        2.908                        0
##                          SPE SPE_Flag       T2 T2_Flag Alarm
## 2017-01-27 00:09:57 3.037163        0 20.10516       0    NA</code></pre>
<p>For some reason, that I don’t know right now, <code>mspMonitor</code> is flagging all of these values as faults, which will trigger alarms for most of the day.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># These lines will test each line as if it was just received:</span>
realAlarmData &lt;-<span class="st"> </span>realDataandFlags
for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(realDataandFlags)){
  realAlarmData[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(realAlarmData[<span class="dv">1</span>:i,])
}
<span class="kw">tail</span>(realAlarmData)</code></pre></div>
<pre><code>## Warning: timezone of object (UTC) is different than current timezone ().</code></pre>
<pre><code>##                     AMBIENT_TEMP.PROCESS_VALUE BIO_1.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                         55                      5.41
## 2017-01-27 11:49:58                         55                      5.33
## 2017-01-27 11:59:55                         55                      5.29
## 2017-01-27 12:09:58                         56                      5.17
## 2017-01-27 12:19:55                         56                      5.08
## 2017-01-27 12:29:57                         57                      5.23
##                     BIO_1.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 11:39:57                              56
## 2017-01-27 11:49:58                              56
## 2017-01-27 11:59:55                              56
## 2017-01-27 12:09:58                              56
## 2017-01-27 12:19:55                              56
## 2017-01-27 12:29:57                              56
##                     BIO_1.TSS.PROCESS_VALUE BIO_2.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                    4873                      5.92
## 2017-01-27 11:49:58                    4569                      5.90
## 2017-01-27 11:59:55                    4813                      5.90
## 2017-01-27 12:09:58                    5001                      5.89
## 2017-01-27 12:19:55                    4882                      5.92
## 2017-01-27 12:29:57                    4943                      5.73
##                     BIO_2.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 11:39:57                              59
## 2017-01-27 11:49:58                              59
## 2017-01-27 11:59:55                              59
## 2017-01-27 12:09:58                              59
## 2017-01-27 12:19:55                              59
## 2017-01-27 12:29:57                              59
##                     BIO_2.TSS.PROCESS_VALUE
## 2017-01-27 11:39:57                    4906
## 2017-01-27 11:49:58                    5386
## 2017-01-27 11:59:55                    5133
## 2017-01-27 12:09:58                    5238
## 2017-01-27 12:19:55                    5506
## 2017-01-27 12:29:57                    5150
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57                            0.10
## 2017-01-27 11:49:58                            3.36
## 2017-01-27 11:59:55                           30.51
## 2017-01-27 12:09:58                            0.10
## 2017-01-27 12:19:55                            0.10
## 2017-01-27 12:29:57                            0.10
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57                           25.89
## 2017-01-27 11:49:58                            0.00
## 2017-01-27 11:59:55                            0.00
## 2017-01-27 12:09:58                            0.64
## 2017-01-27 12:19:55                           25.47
## 2017-01-27 12:29:57                            0.01
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1
## 2017-01-27 11:39:57                                4.933614
## 2017-01-27 11:49:58                                5.802500
## 2017-01-27 11:59:55                                5.358824
## 2017-01-27 12:09:58                                5.252500
## 2017-01-27 12:19:55                                5.797479
## 2017-01-27 12:29:57                                4.954167
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2
## 2017-01-27 11:39:57                                5.870588
## 2017-01-27 11:49:58                                4.915833
## 2017-01-27 11:59:55                                5.404202
## 2017-01-27 12:09:58                                5.545833
## 2017-01-27 12:19:55                                4.751261
## 2017-01-27 12:29:57                                5.771667
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE
## 2017-01-27 11:39:57                             3.721008
## 2017-01-27 11:49:58                             3.737500
## 2017-01-27 11:59:55                             3.723529
## 2017-01-27 12:09:58                             3.723333
## 2017-01-27 12:19:55                             3.730252
## 2017-01-27 12:29:57                             3.725000
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1
## 2017-01-27 11:39:57                               1.692437
## 2017-01-27 11:49:58                               1.992500
## 2017-01-27 11:59:55                               1.844538
## 2017-01-27 12:09:58                               1.800833
## 2017-01-27 12:19:55                               2.007563
## 2017-01-27 12:29:57                               1.714167
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2
## 2017-01-27 11:39:57                               2.028571
## 2017-01-27 11:49:58                               1.714167
## 2017-01-27 11:59:55                               1.878992
## 2017-01-27 12:09:58                               1.922500
## 2017-01-27 12:19:55                               1.660504
## 2017-01-27 12:29:57                               2.010833
##                     MBR.BATCH_VOLUME MBR_1.INF_FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57         260.3040                        10.13
## 2017-01-27 11:49:58         260.3040                        10.06
## 2017-01-27 11:59:55         260.3040                         9.76
## 2017-01-27 12:09:58         260.3040                         9.56
## 2017-01-27 12:19:55         233.7531                         9.62
## 2017-01-27 12:29:57         188.4960                         9.83
##                     MBR_1.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                     9.841
## 2017-01-27 11:49:58                     9.847
## 2017-01-27 11:59:55                     9.839
## 2017-01-27 12:09:58                     9.838
## 2017-01-27 12:19:55                     9.826
## 2017-01-27 12:29:57                     9.819
##                     MBR_1.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57                      2.927731
## 2017-01-27 11:49:58                      2.921667
## 2017-01-27 11:59:55                      2.978992
## 2017-01-27 12:09:58                      2.922500
## 2017-01-27 12:19:55                      1.837815
## 2017-01-27 12:29:57                      0.000000
##                     MBR_1.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 11:39:57                       14.20756
## 2017-01-27 11:49:58                       14.17917
## 2017-01-27 11:59:55                       14.11933
## 2017-01-27 12:09:58                       14.17333
## 2017-01-27 12:19:55                       14.31765
## 2017-01-27 12:29:57                       14.59917
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 11:39:57                      0.07815126
## 2017-01-27 11:49:58                      0.08000000
## 2017-01-27 11:59:55                      0.08907563
## 2017-01-27 12:09:58                      0.08083333
## 2017-01-27 12:19:55                      0.05210084
## 2017-01-27 12:29:57                      0.00000000
##                     MBR_2.INF_FLOW.PROCESS_VALUE MBR_2.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                         9.43                     9.967
## 2017-01-27 11:49:58                         9.30                     9.961
## 2017-01-27 11:59:55                         8.99                     9.957
## 2017-01-27 12:09:58                         8.98                     9.956
## 2017-01-27 12:19:55                         9.04                     9.939
## 2017-01-27 12:29:57                         9.20                     9.938
##                     MBR_2.PERM_FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57                      2.905882
## 2017-01-27 11:49:58                      2.969167
## 2017-01-27 11:59:55                      2.908403
## 2017-01-27 12:09:58                      2.905000
## 2017-01-27 12:19:55                      1.849580
## 2017-01-27 12:29:57                      0.000000
##                     MBR_2.PERM_PRESS.PROCESS_VALUE
## 2017-01-27 11:39:57                       13.92773
## 2017-01-27 11:49:58                       13.91333
## 2017-01-27 11:59:55                       13.83361
## 2017-01-27 12:09:58                       13.88667
## 2017-01-27 12:19:55                       14.02857
## 2017-01-27 12:29:57                       14.30000
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE
## 2017-01-27 11:39:57                       0.2554622
## 2017-01-27 11:49:58                       0.2625000
## 2017-01-27 11:59:55                       0.2865546
## 2017-01-27 12:09:58                       0.2966667
## 2017-01-27 12:19:55                       0.2025210
## 2017-01-27 12:29:57                       0.0000000
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE
## 2017-01-27 11:39:57                                      790
## 2017-01-27 11:49:58                                      790
## 2017-01-27 11:59:55                                      790
## 2017-01-27 12:09:58                                      791
## 2017-01-27 12:19:55                                      792
## 2017-01-27 12:29:57                                      791
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                              3.12
## 2017-01-27 11:49:58                              3.13
## 2017-01-27 11:59:55                              3.12
## 2017-01-27 12:09:58                              3.09
## 2017-01-27 12:19:55                              3.14
## 2017-01-27 12:29:57                              3.07
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE
## 2017-01-27 11:39:57                                0.0359
## 2017-01-27 11:49:58                                0.0351
## 2017-01-27 11:59:55                                0.0363
## 2017-01-27 12:09:58                                0.0426
## 2017-01-27 12:19:55                                0.0350
## 2017-01-27 12:29:57                                0.0328
##                     RAS_TROUGH.PH.PROCESS_VALUE
## 2017-01-27 11:39:57                         6.4
## 2017-01-27 11:49:58                         6.4
## 2017-01-27 11:59:55                         6.5
## 2017-01-27 12:09:58                         6.5
## 2017-01-27 12:19:55                         6.5
## 2017-01-27 12:29:57                         6.6
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE
## 2017-01-27 11:39:57                                   58
## 2017-01-27 11:49:58                                   58
## 2017-01-27 11:59:55                                   58
## 2017-01-27 12:09:58                                   58
## 2017-01-27 12:19:55                                   58
## 2017-01-27 12:29:57                                   58
##                     RAS_TROUGH.TSS.PROCESS_VALUE SEWAGE.FLOW.PROCESS_VALUE
## 2017-01-27 11:39:57                         3902                      0.00
## 2017-01-27 11:49:58                         3953                      0.00
## 2017-01-27 11:59:55                         4386                      0.00
## 2017-01-27 12:09:58                         4434                      0.00
## 2017-01-27 12:19:55                         4277                      8.12
## 2017-01-27 12:29:57                         4129                     11.93
##                     SEWAGE.FLOW.TOTAL_BATCH SEWAGE.LEVEL.PROCESS_VALUE
## 2017-01-27 11:39:57                202.9106                      2.869
## 2017-01-27 11:49:58                202.9106                      2.899
## 2017-01-27 11:59:55                202.9106                      2.886
## 2017-01-27 12:09:58                202.9106                      2.874
## 2017-01-27 12:19:55                141.5200                      2.844
## 2017-01-27 12:29:57                183.1684                      2.718
##                     WAS_FLOW.PROCESS_VALUE AMBIENT_TEMP.PROCESS_VALUE.1
## 2017-01-27 11:39:57              0.0000000                           54
## 2017-01-27 11:49:58              0.0000000                           55
## 2017-01-27 11:59:55              0.0000000                           55
## 2017-01-27 12:09:58              0.0000000                           55
## 2017-01-27 12:19:55              0.4495798                           56
## 2017-01-27 12:29:57              0.0000000                           56
##                     BIO_1.LEVEL.PROCESS_VALUE.1
## 2017-01-27 11:39:57                        5.46
## 2017-01-27 11:49:58                        5.41
## 2017-01-27 11:59:55                        5.33
## 2017-01-27 12:09:58                        5.29
## 2017-01-27 12:19:55                        5.17
## 2017-01-27 12:29:57                        5.08
##                     BIO_1.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                56
## 2017-01-27 11:49:58                                56
## 2017-01-27 11:59:55                                56
## 2017-01-27 12:09:58                                56
## 2017-01-27 12:19:55                                56
## 2017-01-27 12:29:57                                56
##                     BIO_1.TSS.PROCESS_VALUE.1 BIO_2.LEVEL.PROCESS_VALUE.1
## 2017-01-27 11:39:57                      4508                        5.72
## 2017-01-27 11:49:58                      4873                        5.92
## 2017-01-27 11:59:55                      4569                        5.90
## 2017-01-27 12:09:58                      4813                        5.90
## 2017-01-27 12:19:55                      5001                        5.89
## 2017-01-27 12:29:57                      4882                        5.92
##                     BIO_2.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                59
## 2017-01-27 11:49:58                                59
## 2017-01-27 11:59:55                                59
## 2017-01-27 12:09:58                                59
## 2017-01-27 12:19:55                                59
## 2017-01-27 12:29:57                                59
##                     BIO_2.TSS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                      5129
## 2017-01-27 11:49:58                      4906
## 2017-01-27 11:59:55                      5386
## 2017-01-27 12:09:58                      5133
## 2017-01-27 12:19:55                      5238
## 2017-01-27 12:29:57                      5506
##                     BIO_BLOWER_1.FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                              0.10
## 2017-01-27 11:49:58                              0.10
## 2017-01-27 11:59:55                              3.36
## 2017-01-27 12:09:58                             30.51
## 2017-01-27 12:19:55                              0.10
## 2017-01-27 12:29:57                              0.10
##                     BIO_BLOWER_2.FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                              2.73
## 2017-01-27 11:49:58                             25.89
## 2017-01-27 11:59:55                              0.00
## 2017-01-27 12:09:58                              0.00
## 2017-01-27 12:19:55                              0.64
## 2017-01-27 12:29:57                             25.47
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_1.1
## 2017-01-27 11:39:57                                  5.704167
## 2017-01-27 11:49:58                                  4.933614
## 2017-01-27 11:59:55                                  5.802500
## 2017-01-27 12:09:58                                  5.358824
## 2017-01-27 12:19:55                                  5.252500
## 2017-01-27 12:29:57                                  5.797479
##                     MBR.AIR_SCOUR_FLOW.PROCESS_VALUE_TANK_2.1
## 2017-01-27 11:39:57                                  5.083333
## 2017-01-27 11:49:58                                  5.870588
## 2017-01-27 11:59:55                                  4.915833
## 2017-01-27 12:09:58                                  5.404202
## 2017-01-27 12:19:55                                  5.545833
## 2017-01-27 12:29:57                                  4.751261
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE.1
## 2017-01-27 11:39:57                               3.741667
## 2017-01-27 11:49:58                               3.721008
## 2017-01-27 11:59:55                               3.737500
## 2017-01-27 12:09:58                               3.723529
## 2017-01-27 12:19:55                               3.723333
## 2017-01-27 12:29:57                               3.730252
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_1.1
## 2017-01-27 11:39:57                                 1.962500
## 2017-01-27 11:49:58                                 1.692437
## 2017-01-27 11:59:55                                 1.992500
## 2017-01-27 12:09:58                                 1.844538
## 2017-01-27 12:19:55                                 1.800833
## 2017-01-27 12:29:57                                 2.007563
##                     MBR.AIR_SCOUR_PRESSURE.PROCESS_VALUE_2.1
## 2017-01-27 11:39:57                                 1.779167
## 2017-01-27 11:49:58                                 2.028571
## 2017-01-27 11:59:55                                 1.714167
## 2017-01-27 12:09:58                                 1.878992
## 2017-01-27 12:19:55                                 1.922500
## 2017-01-27 12:29:57                                 1.660504
##                     MBR.BATCH_VOLUME.1 MBR_1.INF_FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57           260.3040                          10.18
## 2017-01-27 11:49:58           260.3040                          10.13
## 2017-01-27 11:59:55           260.3040                          10.06
## 2017-01-27 12:09:58           260.3040                           9.76
## 2017-01-27 12:19:55           260.3040                           9.56
## 2017-01-27 12:29:57           233.7531                           9.62
##                     MBR_1.LEVEL.PROCESS_VALUE.1
## 2017-01-27 11:39:57                       9.823
## 2017-01-27 11:49:58                       9.841
## 2017-01-27 11:59:55                       9.847
## 2017-01-27 12:09:58                       9.839
## 2017-01-27 12:19:55                       9.838
## 2017-01-27 12:29:57                       9.826
##                     MBR_1.PERM_FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                        2.910833
## 2017-01-27 11:49:58                        2.927731
## 2017-01-27 11:59:55                        2.921667
## 2017-01-27 12:09:58                        2.978992
## 2017-01-27 12:19:55                        2.922500
## 2017-01-27 12:29:57                        1.837815
##                     MBR_1.PERM_PRESS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                         14.17583
## 2017-01-27 11:49:58                         14.20756
## 2017-01-27 11:59:55                         14.17917
## 2017-01-27 12:09:58                         14.11933
## 2017-01-27 12:19:55                         14.17333
## 2017-01-27 12:29:57                         14.31765
##                     MBR_1.TRANS_PRESS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                        0.08000000
## 2017-01-27 11:49:58                        0.07815126
## 2017-01-27 11:59:55                        0.08000000
## 2017-01-27 12:09:58                        0.08907563
## 2017-01-27 12:19:55                        0.08083333
## 2017-01-27 12:29:57                        0.05210084
##                     MBR_2.INF_FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                           9.42
## 2017-01-27 11:49:58                           9.43
## 2017-01-27 11:59:55                           9.30
## 2017-01-27 12:09:58                           8.99
## 2017-01-27 12:19:55                           8.98
## 2017-01-27 12:29:57                           9.04
##                     MBR_2.LEVEL.PROCESS_VALUE.1
## 2017-01-27 11:39:57                       9.939
## 2017-01-27 11:49:58                       9.967
## 2017-01-27 11:59:55                       9.961
## 2017-01-27 12:09:58                       9.957
## 2017-01-27 12:19:55                       9.956
## 2017-01-27 12:29:57                       9.939
##                     MBR_2.PERM_FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                        2.920000
## 2017-01-27 11:49:58                        2.905882
## 2017-01-27 11:59:55                        2.969167
## 2017-01-27 12:09:58                        2.908403
## 2017-01-27 12:19:55                        2.905000
## 2017-01-27 12:29:57                        1.849580
##                     MBR_2.PERM_PRESS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                         13.95500
## 2017-01-27 11:49:58                         13.92773
## 2017-01-27 11:59:55                         13.91333
## 2017-01-27 12:09:58                         13.83361
## 2017-01-27 12:19:55                         13.88667
## 2017-01-27 12:29:57                         14.02857
##                     MBR_2.TRANS_PRESS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                         0.2533333
## 2017-01-27 11:49:58                         0.2554622
## 2017-01-27 11:59:55                         0.2625000
## 2017-01-27 12:09:58                         0.2865546
## 2017-01-27 12:19:55                         0.2966667
## 2017-01-27 12:29:57                         0.2025210
##                     PERMEATE_TANK.CONDUCTIVITY.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                        790
## 2017-01-27 11:49:58                                        790
## 2017-01-27 11:59:55                                        790
## 2017-01-27 12:09:58                                        790
## 2017-01-27 12:19:55                                        791
## 2017-01-27 12:29:57                                        792
##                     PERMEATE_TANK.LEVEL.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                3.13
## 2017-01-27 11:49:58                                3.12
## 2017-01-27 11:59:55                                3.13
## 2017-01-27 12:09:58                                3.12
## 2017-01-27 12:19:55                                3.09
## 2017-01-27 12:29:57                                3.14
##                     PERMEATE_TANK.TURBIDITY.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                  0.0450
## 2017-01-27 11:49:58                                  0.0359
## 2017-01-27 11:59:55                                  0.0351
## 2017-01-27 12:09:58                                  0.0363
## 2017-01-27 12:19:55                                  0.0426
## 2017-01-27 12:29:57                                  0.0350
##                     RAS_TROUGH.PH.PROCESS_VALUE.1
## 2017-01-27 11:39:57                           6.4
## 2017-01-27 11:49:58                           6.4
## 2017-01-27 11:59:55                           6.4
## 2017-01-27 12:09:58                           6.5
## 2017-01-27 12:19:55                           6.5
## 2017-01-27 12:29:57                           6.5
##                     RAS_TROUGH.TEMPERATURE.PROCESS_VALUE.1
## 2017-01-27 11:39:57                                     58
## 2017-01-27 11:49:58                                     58
## 2017-01-27 11:59:55                                     58
## 2017-01-27 12:09:58                                     58
## 2017-01-27 12:19:55                                     58
## 2017-01-27 12:29:57                                     58
##                     RAS_TROUGH.TSS.PROCESS_VALUE.1
## 2017-01-27 11:39:57                           3948
## 2017-01-27 11:49:58                           3902
## 2017-01-27 11:59:55                           3953
## 2017-01-27 12:09:58                           4386
## 2017-01-27 12:19:55                           4434
## 2017-01-27 12:29:57                           4277
##                     SEWAGE.FLOW.PROCESS_VALUE.1 SEWAGE.FLOW.TOTAL_BATCH.1
## 2017-01-27 11:39:57                       11.95                  186.7015
## 2017-01-27 11:49:58                        0.00                  202.9106
## 2017-01-27 11:59:55                        0.00                  202.9106
## 2017-01-27 12:09:58                        0.00                  202.9106
## 2017-01-27 12:19:55                        0.00                  202.9106
## 2017-01-27 12:29:57                        8.12                  141.5200
##                     SEWAGE.LEVEL.PROCESS_VALUE.1 WAS_FLOW.PROCESS_VALUE.1
## 2017-01-27 11:39:57                        2.755                0.0000000
## 2017-01-27 11:49:58                        2.869                0.0000000
## 2017-01-27 11:59:55                        2.899                0.0000000
## 2017-01-27 12:09:58                        2.886                0.0000000
## 2017-01-27 12:19:55                        2.874                0.0000000
## 2017-01-27 12:29:57                        2.844                0.4495798
##                          SPE SPE_Flag       T2 T2_Flag Alarm
## 2017-01-27 11:39:57 2.997678        0 26.85512       0     0
## 2017-01-27 11:49:58 1.723443        0 27.92596       0     0
## 2017-01-27 11:59:55 3.561266        0 27.36659       0     0
## 2017-01-27 12:09:58 1.513644        0 30.28517       0     0
## 2017-01-27 12:19:55 2.460876        0 31.74495       0     0
## 2017-01-27 12:29:57 3.934860        0 40.36619       0     0</code></pre>
<p>I’m not sure why this is happening. I’ll have to dig in to it later. I do notice that both the SPE and T2 statistics are off the charts. The only component affecting them equally is the projection matrix P. We are estimating a 70 ^ 2 matrix using only 432 observations at a time, so this matrix could very well be unstable (we’d need around 2500 observations to stably estimate the scatter matrix). EDIT: I was not supplying the training mean vector and precision matrix to the monitoring function, which means that the the test observations were not being centred and scaled. This did not make much impact in the simulated data, as the centered and scaled data would not be far off from the original values, except in state 2. This issue is fixed.</p>
</div>
</div>
<div id="simulation-setup" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-setup" class="anchor"></a>Simulation Setup</h1>
<p>We have also collapsed the data generation setup and implementation from this vignette into a function suite. The outward-facing function is called <code>mspProcessData</code>, and we now give an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># If you start working in the vignette here, then load these.</span>
<span class="co"># Otherwise, they were loaded on lines 88 and 529, respectively</span>
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(tidyverse) <span class="co"># Includes readr</span>
<span class="kw">library</span>(mvMonitoring)
<span class="kw">library</span>(xts)
simFaults_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspProcessData.html">mspProcessData</a></span>(<span class="dt">faults =</span> <span class="st">"All"</span>,
                               <span class="dt">faultStartIndex =</span> <span class="dv">8500</span>,
                               <span class="dt">startTime =</span> <span class="st">"2016-11-27 00:00:00 CST"</span>)</code></pre></div>
<p>This process data was generated from a true three-state model. Therefore, our comparison for this data is the false alarm rate and time to alarm for the MSAD-PCA method to the AD-PCA method. We perform this comparison by overwriting the <code>state</code> column of the data frames with a single value (labelling the observations as if they came from a true single-state model).</p>
<div id="true-multi-state-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#true-multi-state-observations" class="anchor"></a>True Multi-State Observations</h2>
<p>We first assume that the observations do come from a multi-state process. This means that we will test AD-PCA by incorrectly assuming that all observations come from the same state. We first draw a list of data matrices. Then we look at false alarm rates for multi-state data under normal operating conditions using AD-PCA and MSAD-PCA. We also measure detection time for all faults for multi-state data under normal operating conditions using AD-PCA and MSAD-PCA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We get warnings of "no non-missing arguments to min; returning Inf" when</span>
<span class="co"># none of the observations yield alarms. Suppress this with ? "message = FALSE"</span>
<span class="co"># doesn't work.</span>
<span class="kw">library</span>(parallel) <span class="co"># use mclapply on Mac, parLapply on Windows</span>
a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">"cl.cores"</span>, <span class="dv">5</span>))
<span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(tidyverse))</code></pre></div>
<pre><code>## [[1]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[2]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[3]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[4]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[5]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(xts))</code></pre></div>
<pre><code>## [[1]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[2]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[3]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[4]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[5]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(mvMonitoring))</code></pre></div>
<pre><code>## [[1]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[2]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[3]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[4]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[5]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">msadResults5_ls &lt;-<span class="st"> </span><span class="kw">parLapply</span>(<span class="dt">cl =</span> cl, <span class="dv">1</span>:<span class="dv">5</span>, function(void){
<span class="co"># msadResults2_ls &lt;- mclapply(1:1000, mc.cores = 8L, function(void){</span>
<span class="co"># msadResults5_ls &lt;- lapply(1:1, function(void){</span>

  ##########   Draw a Random Data Set   ##########
  msadpcaObs_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspProcessData.html">mspProcessData</a></span>(<span class="dt">faults =</span> <span class="st">"All"</span>,
                              <span class="dt">faultStartIndex =</span> <span class="dv">8500</span>,
                              <span class="dt">startTime =</span> <span class="st">"2016-11-27 00:00:00 CST"</span>,
                              <span class="dt">multiState =</span> <span class="ot">TRUE</span>,
                              <span class="dt">adpcaTest =</span> <span class="ot">TRUE</span>)
  
  ##########   False Alarm Rates   ##########
  ###  MSAD-PCA: Assume the Correct State  ###
  <span class="co"># False Alarm Rates (NOC Data)</span>
  msadpcaNOC_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> msadpcaObs_ls$NOC[, <span class="dv">2</span>:<span class="dv">4</span>],
                                    <span class="dt">labelVector =</span> msadpcaObs_ls$NOC[, <span class="dv">1</span>],
                                    <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                    <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                    <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                                    <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
  <span class="co"># SPE</span>
  falseAlarmSPE_msad &lt;-<span class="st"> </span><span class="kw">sum</span>(msadpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(msadpcaNOC_ls$FaultChecks)
  <span class="co"># T2</span>
  falseAlarmT2_msad &lt;-<span class="st"> </span><span class="kw">sum</span>(msadpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(msadpcaNOC_ls$FaultChecks)
  
  ###  AD-PCA: Incorrectly Assume Equal States  ###
  adpcaNOC_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> msadpcaObs_ls$NOC[, <span class="dv">2</span>:<span class="dv">4</span>],
                                  <span class="dt">labelVector =</span> msadpcaObs_ls$NOC[, <span class="dv">5</span>],
                                  <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                  <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                  <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                                  <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
  <span class="co"># SPE</span>
  falseAlarmSPE_ad &lt;-<span class="st"> </span><span class="kw">sum</span>(adpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(adpcaNOC_ls$FaultChecks)
  <span class="co"># T2</span>
  falseAlarmT2_ad &lt;-<span class="st"> </span><span class="kw">sum</span>(adpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(adpcaNOC_ls$FaultChecks)
  
  ###  Return Data Frame  ###
  FA_rates &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">MSAD_SPE =</span> falseAlarmSPE_msad,
                         <span class="dt">MSAD_T2 =</span> falseAlarmT2_msad,
                         <span class="dt">AD_SPE =</span> falseAlarmSPE_ad,
                         <span class="dt">AD_T2 =</span> falseAlarmT2_ad)
  
  ##########   Time to Fault Detection   ##########
  
  <span class="co"># Train the two models</span>
  msadpca_MS_Results_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> msadpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">2</span>:<span class="dv">4</span>],
                            <span class="dt">labelVector =</span> msadpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">1</span>],
                            <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                            <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                            <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                            <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  adpca_MS_Results_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> msadpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">2</span>:<span class="dv">4</span>],
                          <span class="dt">labelVector =</span> msadpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">5</span>],
                          <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                          <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                          <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                          <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Subset out the normal operating data</span>
  faultsSimRes &lt;-<span class="st"> </span><span class="kw">lapply</span>(msadpcaObs_ls[<span class="kw">names</span>(msadpcaObs_ls) !=<span class="st"> "NOC"</span>],
                         function(mat){
                           
    <span class="co"># Testing the apply statement</span>
    <span class="co"># mat &lt;- msadpcaObs_ls$C1</span>
    
    ###  MSAD-PCA: Assume the Correct State  ###
    <span class="co"># Take our testing data</span>
    testObs &lt;-<span class="st"> </span>mat[<span class="dv">7499</span>:<span class="dv">10080</span>, <span class="dv">2</span>:<span class="dv">4</span>]
    <span class="co"># lag the test data and cut the NA observations</span>
    testObs &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/diff">lag.xts</a></span>(testObs, <span class="dv">0</span>:<span class="dv">2</span>)
    testObs &lt;-<span class="st"> </span>testObs[-(<span class="dv">1</span>:<span class="dv">2</span>),]
    <span class="co"># re-attach the *CORRECT* state label</span>
    msad_MS_TestObs &lt;-<span class="st"> </span><span class="kw">cbind</span>(mat[<span class="dv">7501</span>:<span class="dv">10080</span>, <span class="dv">1</span>], testObs)
    <span class="co"># Run the test data through the Monitor function</span>
    msad_MS_DataandFlags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> msad_MS_TestObs[,-<span class="dv">1</span>],
                                       <span class="dt">labelVector =</span> msad_MS_TestObs[,<span class="dv">1</span>],
                                       <span class="dt">trainingSummary =</span>
                                         msadpca_MS_Results_ls$TrainingSpecs)
    <span class="co"># Check for alarms</span>
    msad_MS_Alarm &lt;-<span class="st"> </span>msad_MS_DataandFlags
    for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(msad_MS_DataandFlags)){
      msad_MS_Alarm[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(msad_MS_Alarm[<span class="dv">1</span>:i,])
    }
    
    ## Time to first alarm
    alarmCol &lt;-<span class="st"> </span><span class="kw">ncol</span>(msad_MS_Alarm)
    <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
    <span class="co"># Use suppressWarnings() on the min() function. If the which() function</span>
    <span class="co"># returns an integer(0), its minimum is Inf, but it throws a warning. These</span>
    <span class="co"># warnings will fill the console under heavy repitition, so suppress them.</span>
    <span class="co"># SPE</span>
    <span class="co"># All alarms: which(msad_MS_Alarm[1:2580,alarmCol] %in% c(2,3))</span>
    time2SPE_msad &lt;-<span class="st"> </span><span class="kw">which</span>(msad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))
    time2SPE_msad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2SPE_msad))
    <span class="co"># T2</span>
    <span class="co"># All alarms: which(msad_MS_Alarm[1:2580,alarmCol] %in% c(1,3))</span>
    time2T2_msad &lt;-<span class="st"> </span><span class="kw">which</span>(msad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
    time2T2_msad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2T2_msad))
    
    
    
    ###  AD-PCA: Assume Equal States  ###
    <span class="co"># Attach the *incorrect* state label instead of the correct label</span>
    ad_MS_TestObs &lt;-<span class="st"> </span><span class="kw">cbind</span>(mat[<span class="dv">7501</span>:<span class="dv">10080</span>, <span class="dv">5</span>], testObs)
    <span class="co"># Run the test data through the Monitor function</span>
    ad_MS_DataandFlags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> ad_MS_TestObs[,-<span class="dv">1</span>],
                                     <span class="dt">labelVector =</span> ad_MS_TestObs[,<span class="dv">1</span>],
                                     <span class="dt">trainingSummary =</span>
                                       adpca_MS_Results_ls$TrainingSpecs)
    <span class="co"># Check for alarms</span>
    ad_MS_Alarm &lt;-<span class="st"> </span>ad_MS_DataandFlags
    for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(msad_MS_DataandFlags)){
      ad_MS_Alarm[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(ad_MS_Alarm[<span class="dv">1</span>:i,])
    }
    
    ## Time to first alarm
    alarmCol &lt;-<span class="st"> </span><span class="kw">ncol</span>(ad_MS_Alarm)
    <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
    <span class="co"># SPE</span>
    <span class="co"># All alarms: which(ad_MS_Alarm[,alarmCol] %in% c(2,3))</span>
    time2SPE_ad &lt;-<span class="st"> </span><span class="kw">which</span>(ad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))
    time2SPE_ad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2SPE_ad))
    <span class="co"># T2</span>
    <span class="co"># All alarms: which(ad_MS_Alarm[,alarmCol] %in% c(1,3))</span>
    time2T2_ad &lt;-<span class="st"> </span><span class="kw">which</span>(ad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
    time2T2_ad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2T2_ad))
    
    ###  Return Data Frame  ###
    <span class="kw">data.frame</span>(<span class="dt">MSAD_SPE =</span> time2SPE_msad,
               <span class="dt">MSAD_T2 =</span> time2T2_msad,
               <span class="dt">AD_SPE =</span> time2SPE_ad,
               <span class="dt">AD_T2 =</span> time2T2_ad)
  }) %&gt;%
<span class="st">    </span><span class="kw">do.call</span>(bind_rows, .) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Faults =</span> <span class="kw">names</span>(msadpcaObs_ls[<span class="kw">names</span>(msadpcaObs_ls) !=<span class="st"> "NOC"</span>]))
  
  ##########   Return a List   ##########
  <span class="kw">list</span>(<span class="dt">falseAlarmRates =</span> FA_rates,
       <span class="dt">time2Detect =</span> faultsSimRes)
})
b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() 
b -<span class="st"> </span>a <span class="co"># 91 seconds for each iteration. 15.3 minutes for 10 iterations, 12.1 </span></code></pre></div>
<pre><code>## Time difference of 3.014268 mins</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hours for 500 iterations. On parallel Mac, 5.3 minutes for 10 iterations over</span>
<span class="co"># 8 cores, 41.4 minutes for 100 iterations over 8 cores, and 6.7 hours for 1000</span>
<span class="co"># iterations over 8 cores. On parallel Windows, 4.3 minutes for 10 iterations</span>
<span class="co"># over 8 cores, and 5.4 hours for 1000 iterations over 8 cores.</span>
<span class="kw">stopCluster</span>(cl)</code></pre></div>
<p>Let’s clean up these results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ms_FA_rates5 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(msadResults5_ls), function(i){
  msadResults5_ls[[i]]$falseAlarmRates
}) %&gt;%<span class="st"> </span><span class="kw">do.call</span>(bind_rows, .)
<span class="co"># write_csv(ms_FA_rates4, path = "false_alarm_rates_ms_1000_20170323.csv")</span>
ms_detectionTimes5 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(msadResults5_ls), function(i){
  msadResults5_ls[[i]]$time2Detect
}) %&gt;%<span class="st"> </span><span class="kw">do.call</span>(bind_rows, .)
<span class="co"># write_csv(ms_detectionTimes4, path = "detection_times_ms_1000_20170323.csv")</span></code></pre></div>
<p>Now we can look at the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># False Alarm Rates</span>
ms_FA_rates5[,<span class="dv">1</span>] %&gt;%<span class="st"> </span><span class="kw">hist</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="dt">main =</span> <span class="st">"MSAD SPE False Alarm Rates"</span>)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/msadSim_graphics-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ms_FA_rates5[,<span class="dv">2</span>] %&gt;%<span class="st"> </span><span class="kw">hist</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="dt">main =</span> <span class="st">"MSAD T2 False Alarm Rates"</span>)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/msadSim_graphics-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ms_FA_rates5[,<span class="dv">3</span>] %&gt;%<span class="st"> </span><span class="kw">hist</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="dt">main =</span> <span class="st">"AD SPE False Alarm Rates"</span>)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/msadSim_graphics-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ms_FA_rates5[,<span class="dv">4</span>] %&gt;%<span class="st"> </span><span class="kw">hist</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="dt">main =</span> <span class="st">"AD T2 False Alarm Rates"</span>)</code></pre></div>
<p><img src="Simulation_Vignette_files/figure-html/msadSim_graphics-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###  Detection Times  ###
<span class="co"># Fault 1A</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "A1"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.         5.0     5.0    Inf   Inf
## 1st Qu.      5.0     5.0    Inf   Inf
## Median       5.0     5.0    Inf   Inf
## Mean         8.2    13.4    Inf   Inf
## 3rd Qu.     10.0    26.0    Inf   Inf
## Max.        16.0    26.0    Inf   Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fault 1B</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "B1"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.           5    26.0    Inf   Inf
## 1st Qu.        5    32.0    Inf   Inf
## Median         5    40.0    Inf   Inf
## Mean           5    79.8    Inf   Inf
## 3rd Qu.        5    67.0    Inf   Inf
## Max.           5   234.0    Inf   Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fault 2A</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "A2"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.       317.0   332.0    Inf   Inf
## 1st Qu.    363.0   508.0    Inf   Inf
## Median     446.0   512.0    Inf   Inf
## Mean       405.4   501.2    Inf   Inf
## 3rd Qu.    446.0   569.0    Inf   Inf
## Max.       455.0   585.0    Inf   Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fault 2B</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "B2"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.         317   531.0    Inf  1254
## 1st Qu.      452   557.0    Inf  1421
## Median       453   589.0    Inf  1445
## Mean         429   624.2    Inf   Inf
## 3rd Qu.      455   689.0    Inf  1458
## Max.         468   755.0    Inf   Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fault 3A</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "A3"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.         Inf     Inf    Inf   Inf
## 1st Qu.      Inf     Inf    Inf   Inf
## Median       Inf     Inf    Inf   Inf
## Mean         Inf     Inf    Inf   Inf
## 3rd Qu.      Inf     Inf    Inf   Inf
## Max.         Inf     Inf    Inf   Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fault 3B</span>
ms_detectionTimes5 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Faults ==<span class="st"> "B3"</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-Faults) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">sapply</span>(summary)</code></pre></div>
<pre><code>##         MSAD_SPE MSAD_T2 AD_SPE AD_T2
## Min.       123.0   533.0  421.0 495.0
## 1st Qu.    140.0   560.0  495.0 561.0
## Median     141.0   866.0  569.0 569.0
## Mean       208.6   813.4  595.8 605.2
## 3rd Qu.    305.0   954.0  744.0 651.0
## Max.       334.0  1154.0  750.0 750.0</code></pre>
</div>
<div id="true-single-state-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#true-single-state-observations" class="anchor"></a>True Single-State Observations</h2>
<p>We first assume that the observations do not come from a multi-state process. This means that we will test MSAD-PCA by incorrectly assuming that observations come from different states: we will assign a state at random to each observation from “1”, “2”, or “3”. We first draw a list of data matrices. Then we look at false alarm rates for multi-state data under normal operating conditions using AD-PCA and MSAD-PCA. We also measure detection time for all faults for single-state data under normal operating conditions using AD-PCA and MSAD-PCA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(parallel) # use mclapply on Mac, parLapply on Windows</span>
<span class="co"># library(tidyverse)</span>
<span class="co"># library(xts)</span>
a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">"cl.cores"</span>, <span class="dv">5</span>))
<span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(tidyverse))</code></pre></div>
<pre><code>## [[1]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[2]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[3]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[4]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"     
## 
## [[5]]
##  [1] "dplyr"     "purrr"     "readr"     "tidyr"     "tibble"   
##  [6] "ggplot2"   "tidyverse" "stats"     "graphics"  "grDevices"
## [11] "utils"     "datasets"  "methods"   "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(xts))</code></pre></div>
<pre><code>## [[1]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[2]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[3]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[4]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"     
## 
## [[5]]
##  [1] "xts"       "zoo"       "dplyr"     "purrr"     "readr"    
##  [6] "tidyr"     "tibble"    "ggplot2"   "tidyverse" "stats"    
## [11] "graphics"  "grDevices" "utils"     "datasets"  "methods"  
## [16] "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clusterEvalQ</span>(cl, <span class="kw">library</span>(mvMonitoring))</code></pre></div>
<pre><code>## [[1]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[2]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[3]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[4]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"        
## 
## [[5]]
##  [1] "mvMonitoring" "xts"          "zoo"          "dplyr"       
##  [5] "purrr"        "readr"        "tidyr"        "tibble"      
##  [9] "ggplot2"      "tidyverse"    "stats"        "graphics"    
## [13] "grDevices"    "utils"        "datasets"     "methods"     
## [17] "base"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">adResults3_ls &lt;-<span class="st"> </span><span class="kw">parLapply</span>(<span class="dt">cl =</span> cl, <span class="dv">1</span>:<span class="dv">5</span>, function(void){
<span class="co"># adResults_ls &lt;- mclapply(1:1000, mc.cores = 8L, function(void){</span>
  ##########   Draw a Random Data Set   ##########
  adpcaObs_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspProcessData.html">mspProcessData</a></span>(<span class="dt">faults =</span> <span class="st">"All"</span>,
                              <span class="dt">faultStartIndex =</span> <span class="dv">8500</span>,
                              <span class="dt">startTime =</span> <span class="st">"2016-11-27 00:00:00 CST"</span>,
                              <span class="dt">multiState =</span> <span class="ot">FALSE</span>,
                              <span class="dt">msadpcaTest =</span> <span class="ot">TRUE</span>)
  
  ##########   False Alarm Rates   ##########
  ###  MSAD-PCA: Assume the Incorrect State  ###
  <span class="co"># False Alarm Rates (NOC Data)</span>
  msadpcaNOC_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> adpcaObs_ls$NOC[, <span class="dv">2</span>:<span class="dv">4</span>],
                                    <span class="dt">labelVector =</span> adpcaObs_ls$NOC[, <span class="dv">5</span>],
                                    <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                    <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                    <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                                    <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
  <span class="co"># SPE</span>
  falseAlarmSPE_msad &lt;-<span class="st"> </span><span class="kw">sum</span>(msadpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(msadpcaNOC_ls$FaultChecks)
  <span class="co"># T2</span>
  falseAlarmT2_msad &lt;-<span class="st"> </span><span class="kw">sum</span>(msadpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(msadpcaNOC_ls$FaultChecks)
  
  ###  AD-PCA: Correctly Assume Equal States  ###
  adpcaNOC_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> adpcaObs_ls$NOC[, <span class="dv">2</span>:<span class="dv">4</span>],
                                  <span class="dt">labelVector =</span> adpcaObs_ls$NOC[, <span class="dv">1</span>],
                                  <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                  <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                                  <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                                  <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
  <span class="co"># SPE</span>
  falseAlarmSPE_ad &lt;-<span class="st"> </span><span class="kw">sum</span>(adpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(adpcaNOC_ls$FaultChecks)
  <span class="co"># T2</span>
  falseAlarmT2_ad &lt;-<span class="st"> </span><span class="kw">sum</span>(adpcaNOC_ls$FaultChecks[,<span class="dv">5</span>] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) /
<span class="st">    </span><span class="kw">nrow</span>(adpcaNOC_ls$FaultChecks)
  
  ###  Return Data Frame  ###
  FA_rates &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">MSAD_SPE =</span> falseAlarmSPE_msad,
                         <span class="dt">MSAD_T2 =</span> falseAlarmT2_msad,
                         <span class="dt">AD_SPE =</span> falseAlarmSPE_ad,
                         <span class="dt">AD_T2 =</span> falseAlarmT2_ad)
  
  ##########   Time to Fault Detection   ##########
  
  <span class="co"># Train the two models</span>
  msadpca_MS_Results_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> adpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">2</span>:<span class="dv">4</span>],
  <span class="co"># Data is truly single-state, so we point the label vector at the wrong</span>
  <span class="co"># column for the multi-state implementation. The states in column 5 are</span>
  <span class="co"># generated at random</span>
                            <span class="dt">labelVector =</span> adpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">5</span>],
                            <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                            <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                            <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                            <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  adpca_MS_Results_ls &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspTrain.html">mspTrain</a></span>(<span class="dt">data =</span> adpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">2</span>:<span class="dv">4</span>],
  <span class="co"># Data is truly single-state, so we point the label vector at the correct</span>
  <span class="co"># column for the single-state implementation. The state in column 1 is all</span>
  <span class="co"># the same value</span>
                          <span class="dt">labelVector =</span> adpcaObs_ls$NOC[<span class="dv">1</span>:<span class="dv">7500</span>, <span class="dv">1</span>],
                          <span class="dt">trainObs =</span> <span class="dv">3</span> *<span class="st"> </span><span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                          <span class="dt">updateFreq =</span> <span class="dv">24</span> *<span class="st"> </span><span class="dv">60</span>,
                          <span class="dt">alpha =</span> <span class="fl">0.001</span>,
                          <span class="dt">lagsIncluded =</span> <span class="dv">0</span>:<span class="dv">2</span>)
  
  <span class="co"># Subset out the normal operating data</span>
  faultsSimRes &lt;-<span class="st"> </span><span class="kw">lapply</span>(adpcaObs_ls[<span class="kw">names</span>(adpcaObs_ls) !=<span class="st"> "NOC"</span>],
                         function(mat){
    
    ###  MSAD-PCA: Assume the Incorrect State  ###
    <span class="co"># Take our testing data</span>
    testObs &lt;-<span class="st"> </span>mat[<span class="dv">7499</span>:<span class="dv">10080</span>, <span class="dv">2</span>:<span class="dv">4</span>]
    <span class="co"># lag the test data and cut the NA observations</span>
    testObs &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/diff">lag.xts</a></span>(testObs, <span class="dv">0</span>:<span class="dv">2</span>)
    testObs &lt;-<span class="st"> </span>testObs[-(<span class="dv">1</span>:<span class="dv">2</span>),]
    <span class="co"># Attach the *incorrect* state label instead of the correct label</span>
    msad_MS_TestObs &lt;-<span class="st"> </span><span class="kw">cbind</span>(mat[<span class="dv">7501</span>:<span class="dv">10080</span>, <span class="dv">5</span>], testObs)
    <span class="co"># Run the test data through the Monitor function</span>
    msad_MS_DataandFlags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> msad_MS_TestObs[,-<span class="dv">1</span>],
                                       <span class="dt">labelVector =</span> msad_MS_TestObs[,<span class="dv">1</span>],
                                       <span class="dt">trainingSummary =</span>
                                         msadpca_MS_Results_ls$TrainingSpecs)
    <span class="co"># Check for alarms</span>
    msad_MS_Alarm &lt;-<span class="st"> </span>msad_MS_DataandFlags
    for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(msad_MS_DataandFlags)){
      msad_MS_Alarm[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(msad_MS_Alarm[<span class="dv">1</span>:i,])
    }
    
    ## Time to first alarm
    alarmCol &lt;-<span class="st"> </span><span class="kw">ncol</span>(msad_MS_Alarm)
    <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
    <span class="co"># Use suppressWarnings() on the min() function. If the which() function</span>
    <span class="co"># returns an integer(0), its minimum is Inf, but it throws a warning. These</span>
    <span class="co"># warnings will fill the console under heavy repitition, so suppress them.</span>
    <span class="co"># SPE</span>
    time2SPE_msad &lt;-<span class="st"> </span><span class="kw">which</span>(msad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))
    time2SPE_msad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2SPE_msad))
    <span class="co"># T2</span>
    time2T2_msad &lt;-<span class="st"> </span><span class="kw">which</span>(msad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
    time2T2_msad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2T2_msad))
    
    
    
    ###  AD-PCA: Assume Equal States  ###
    <span class="co"># re-attach the *CORRECT* state label</span>
    ad_MS_TestObs &lt;-<span class="st"> </span><span class="kw">cbind</span>(mat[<span class="dv">7501</span>:<span class="dv">10080</span>, <span class="dv">1</span>], testObs)
    <span class="co"># Run the test data through the Monitor function</span>
    ad_MS_DataandFlags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspMonitor.html">mspMonitor</a></span>(<span class="dt">observations =</span> ad_MS_TestObs[,-<span class="dv">1</span>],
                                     <span class="dt">labelVector =</span> ad_MS_TestObs[,<span class="dv">1</span>],
                                     <span class="dt">trainingSummary =</span>
                                       adpca_MS_Results_ls$TrainingSpecs)
    <span class="co"># Check for alarms</span>
    ad_MS_Alarm &lt;-<span class="st"> </span>ad_MS_DataandFlags
    for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(ad_MS_DataandFlags)){
      ad_MS_Alarm[<span class="dv">1</span>:i,] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mspWarning.html">mspWarning</a></span>(ad_MS_Alarm[<span class="dv">1</span>:i,])
    }
    
    ## Time to first alarm
    alarmCol &lt;-<span class="st"> </span><span class="kw">ncol</span>(msad_MS_Alarm)
    <span class="co"># Alarm code: 1 = T2 alarm; 2 = SPE alarm; 3 = both</span>
    <span class="co"># SPE</span>
    time2SPE_ad &lt;-<span class="st"> </span><span class="kw">which</span>(ad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))
    time2SPE_ad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2SPE_ad))
    <span class="co"># T2</span>
    time2T2_ad &lt;-<span class="st"> </span><span class="kw">which</span>(ad_MS_Alarm[<span class="dv">1000</span>:<span class="dv">2580</span>,alarmCol] %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
    time2T2_ad &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">min</span>(time2T2_ad))
    
    ###  Return Data Frame  ###
    <span class="kw">data.frame</span>(<span class="dt">MSAD_SPE =</span> time2SPE_msad,
               <span class="dt">MSAD_T2 =</span> time2T2_msad,
               <span class="dt">AD_SPE =</span> time2SPE_ad,
               <span class="dt">AD_T2 =</span> time2T2_ad)
  }) %&gt;%
<span class="st">    </span><span class="kw">do.call</span>(bind_rows, .) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Faults =</span> <span class="kw">names</span>(adpcaObs_ls[<span class="kw">names</span>(adpcaObs_ls) !=<span class="st"> "NOC"</span>]))
  
  ##########   Return a List   ##########
  <span class="kw">list</span>(<span class="dt">falseAlarmRates =</span> FA_rates,
       <span class="dt">time2Detect =</span> faultsSimRes)
})
b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() 
b -<span class="st"> </span>a <span class="co"># On parallel Mac, 5.9 minutes for 10 iterations over 8 cores and 14.6</span></code></pre></div>
<pre><code>## Time difference of 3.348068 mins</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hours for 1000 iterations over 8 cores. On parallel Windows, 4.5 minutes for</span>
<span class="co"># 10 iterations over 8 cores, and 6.0 hours for 1000 iterations over 8 cores.</span>
<span class="kw">stopCluster</span>(cl)</code></pre></div>
<p>Let’s clean up these results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ss_FA_rates &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(adResults3_ls), function(i){
  adResults3_ls[[i]]$falseAlarmRates
}) %&gt;%<span class="st"> </span><span class="kw">do.call</span>(bind_rows, .)
<span class="co"># write_csv(ss_FA_rates, path = "false_alarm_rates_ss_1000_20170320.csv")</span>
ss_detectionTimes &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(adResults3_ls), function(i){
  adResults3_ls[[i]]$time2Detect
}) %&gt;%<span class="st"> </span><span class="kw">do.call</span>(bind_rows, .)
<span class="co"># write_csv(ss_detectionTimes, path = "detection_times_ss_1000_20170320.csv")</span></code></pre></div>
<p>Now we can look at the results.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#multi-state-adaptive-dynamic-pca-simulation">Multi-State Adaptive-Dynamic PCA Simulation</a></li>
      <li><a href="#multi-state-ad-pca-implementation">Multi-State AD-PCA Implementation</a></li>
      <li><a href="#test-the-multi-state-monitoring-function">Test the Multi-State Monitoring function</a></li>
      <li><a href="#test-the-warning-function">Test the Warning function</a></li>
      <li><a href="#real-data">Real Data</a></li>
      <li>
<a href="#simulation-setup">Simulation Setup</a><ul class="nav nav-pills nav-stacked">
<li><a href="#true-multi-state-observations">True Multi-State Observations</a></li>
      <li><a href="#true-single-state-observations">True Single-State Observations</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/melissanjohnson">Melissa Johnson</a>, <a href="https://github.com/gabrielodom">Gabriel Odom</a>, <a href="http://benbarnard.bearstatistics.com">Ben Barnard</a>, Karen Kazor, Amanda Hering.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
